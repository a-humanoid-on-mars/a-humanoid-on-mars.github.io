<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—äº¬å¤§å­¦æ ‘æ´æ¡£æ¡ˆé¦†</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* åŒ—å¤§çº¢æ ‡å‡†è‰²å· */
            --primary-color:  #940D14; 
            --secondary-color: #940D14;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f8f8;
            --bg-tertiary: #f2f2f2;
            --text-primary: #111111;
            --text-secondary: #666666;
            --text-tertiary: #999999;
            --border-color: #e8e8e8;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --card-radius: 16px;
            --small-radius: 8px;
            --modal-bg: rgba(0, 0, 0, 0.5);
            
            /* çƒ­åº¦é¢œè‰² */
            --hotness-purple: #8A2BE2; /* å‰1% - ç´«è‰² */
            --hotness-red: #FF6B6B; /* 1%-5% - çº¢è‰² */
            --hotness-orange: #FF8E53; /* 5%-20% - æ©™è‰² */
            --hotness-gray: #999999; /* 20%-99% - ç°è‰² */
            --hotness-green: #4CAF50; /* çƒ­åº¦1.0 - ç»¿è‰² */
            --recommend-blue: #4A90E2; /* æ¨èæ ‡ç­¾è“è‰² */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Helvetica Neue", Arial, sans-serif;
        }

        body {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        /* å½“å‰æ—¥æœŸæ˜¾ç¤ºæ  */
        .current-date-bar {
            position: sticky;
            top: 0;
            z-index: 900;
            background: linear-gradient(135deg, var(--primary-color), #b71c1c);
            color: white;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transform: translateY(-100%);
            transition: transform 0.3s ease;
            margin-top: -1px; /* ä¸headeré‡å 1pxé¿å…é—´éš™ */
        }

        .current-date-bar.visible {
            transform: translateY(0);
        }

        .date-bar-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .date-bar-title {
            font-weight: 600;
            font-size: 14px;
            opacity: 0.9;
        }

        .current-date-display {
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .date-bar-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .date-bar-stats {
            font-size: 12px;
            opacity: 0.8;
            display: flex;
            gap: 12px;
        }

        .date-bar-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .date-bar-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--modal-bg);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--bg-primary);
            border-radius: var(--card-radius);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background-color: var(--bg-primary);
            z-index: 10;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-tertiary);
            font-size: 20px;
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-section {
            margin-bottom: 24px;
        }

        .modal-section h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-section h4 {
            font-size: 16px;
            font-weight: 600;
            margin: 16px 0 8px;
            color: var(--text-secondary);
        }

        .modal-section p {
            margin-bottom: 12px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .modal-section ul {
            margin-left: 20px;
            margin-bottom: 16px;
        }

        .modal-section li {
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .feature-item {
            background-color: var(--bg-secondary);
            padding: 16px;
            border-radius: var(--small-radius);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .feature-icon {
            width: 40px;
            height: 40px;
            background-color: rgba(148, 13, 20, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 18px;
            flex-shrink: 0;
        }

        .feature-text {
            flex: 1;
        }

        .feature-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .feature-desc {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .shortcut-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .shortcut-item {
            background-color: var(--bg-secondary);
            padding: 12px;
            border-radius: var(--small-radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .shortcut-action {
            font-weight: 500;
            color: var(--text-primary);
        }

        .shortcut-key {
            background-color: var(--bg-primary);
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background-color: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 20px;
            color: var(--primary-color);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .header-actions {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: center;
        }

        .header-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 16px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: var(--small-radius);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .header-btn:hover {
            background-color: var(--bg-tertiary);
            color: var(--primary-color);
        }

        .header-btn i {
            font-size: 14px;
        }

        /* å¼€å…³æ ·å¼ */
        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background-color: var(--border-color);
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            flex-shrink: 0;
        }

        .toggle-switch.active {
            background-color: var(--primary-color);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .toggle-switch.active::after {
            left: 22px;
        }

        .toggle-group {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: var(--bg-tertiary);
            padding: 6px 12px;
            border-radius: 6px;
        }

        .toggle-label {
            font-size: 14px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        /* ç°ä»£æ—¥æœŸé€‰æ‹©å™¨æ ·å¼ */
        .date-selector-container {
            background-color: var(--bg-primary);
            border-radius: var(--card-radius);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--card-shadow);
        }

        .date-selector-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .date-selector-grid {
            display: grid;
            grid-template-columns: auto 1fr auto auto auto;
            gap: 12px;
            align-items: center;
            margin-bottom: 16px;
        }

        .mode-indicator {
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mode-toggle {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 600;
            padding: 0 4px;
        }

        .date-input-wrapper {
            position: relative;
            flex: 1;
        }

        .date-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 16px;
            color: var(--text-primary);
            background-color: var(--bg-primary);
            transition: all 0.2s;
        }

        .date-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(148, 13, 20, 0.1);
        }

        .date-input-label {
            position: absolute;
            top: -8px;
            left: 8px;
            background-color: var(--bg-primary);
            padding: 0 4px;
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .date-button {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .date-button.primary {
            background-color: var(--primary-color);
            color: white;
        }

        .date-button.primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .date-button.secondary {
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .date-button.secondary:hover {
            background-color: var(--border-color);
        }

        .date-button.small {
            padding: 8px 12px;
            font-size: 14px;
        }

        .date-info {
            background-color: rgba(148, 13, 20, 0.05);
            border-left: 3px solid var(--primary-color);
            border-radius: 4px;
            padding: 12px;
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .date-range {
            font-weight: 600;
            color: var(--primary-color);
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
            background-color: var(--bg-primary);
            border-radius: var(--card-radius);
            box-shadow: var(--card-shadow);
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background-color: var(--bg-secondary);
            border-radius: 6px;
        }

        .control-label {
            font-size: 14px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .sort-select {
            padding: 6px 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            color: var(--text-primary);
            background-color: var(--bg-primary);
            cursor: pointer;
            transition: all 0.2s;
            min-width: 140px;
        }

        .sort-select:hover {
            border-color: var(--primary-color);
        }

        .sort-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(148, 13, 20, 0.1);
        }

        /* æ–‡ä»¶ä¿¡æ¯ */
        .file-info {
            margin-top: 20px;
            padding: 16px;
            background-color: var(--bg-tertiary);
            border-radius: var(--small-radius);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .file-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .file-stats {
            display: flex;
            gap: 16px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* åˆ†å±å¸ƒå±€ */
        .split-layout {
            display: flex;
            gap: 24px;
            min-height: 600px;
        }

        /* å¸–å­å®¹å™¨ */
        .posts-container {
            flex: 1;
            max-width: 600px;
            position: relative;
        }

        .posts-container.full-width {
            max-width: 100%;
            flex: 1 1 100%;
        }

        /* å¸–å­åˆ—è¡¨æ£€æµ‹åŒº */
        .posts-scroll-area {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 40px;
            cursor: default;
            z-index: 1;
        }

        /* å³ä¾§é¢æ¿ */
        .right-panel {
            flex: 1;
            background-color: var(--bg-primary);
            border-radius: var(--card-radius);
            box-shadow: var(--card-shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: sticky;
            top: 120px; /* é€‚åº”æ—¥æœŸæ é«˜åº¦ */
            max-height: calc(100vh - 170px);
        }

        .right-panel.empty {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .right-panel-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--bg-primary);
            position: sticky;
            top: 0;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .right-panel-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .right-panel-close {
            background: none;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            font-size: 16px;
        }

        .right-panel-close:hover {
            color: var(--primary-color);
        }

        .right-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .empty-panel {
            text-align: center;
            padding: 60px 24px;
            color: var(--text-tertiary);
        }

        .empty-panel-icon {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--border-color);
        }

        .empty-panel-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        /* å³ä¾§é¢æ¿ä¸­çš„å¸–å­è¯¦æƒ… */
        .post-detail-card {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .post-detail-content {
            font-size: 16px;
            line-height: 1.7;
            white-space: pre-wrap;
            word-break: break-word;
            margin-bottom: 16px;
        }

        .post-detail-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-tertiary);
            font-size: 14px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .post-detail-id {
            background-color: var(--bg-tertiary);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: monospace;
        }

        /* æ ‘æ´å¡ç‰‡ */
        .hole-card {
            background-color: var(--bg-primary);
            border-radius: var(--card-radius);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--card-shadow);
            transition: all 0.3s;
            position: relative;
        }

        .hole-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        }

        .hole-card.clickable {
            cursor: pointer;
        }

        .hole-card.active {
            border-left: 4px solid var(--primary-color);
            background-color: rgba(148, 13, 20, 0.03);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .user-info {
            flex: 1;
        }

        .username {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .post-time {
            color: var(--text-tertiary);
            font-size: 14px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
            flex-wrap: wrap;
            width: 100%;
        }

        .post-id {
            background-color: var(--bg-tertiary);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            flex-shrink: 0;
        }

        .post-content-inline {
            flex: 1;
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.6;
            word-break: break-word;
        }

        .post-votes {
            flex-shrink: 0;
        }

        .post-time-info {
            margin-left: auto;
            flex-shrink: 0;
        }

        .post-votes {
            margin-left: auto;
            color: var(--text-secondary);
            font-size: 13px;
        }

        .card-content {
            font-size: 16px;
            line-height: 1.7;
            margin-bottom: 16px;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .card-stats {
            display: flex;
            gap: 24px;
            color: var(--text-secondary);
            font-size: 14px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        /* çƒ­åº¦æ ‡ç­¾ - æ ¹æ®çƒ­åº¦çº§åˆ«ä½¿ç”¨ä¸åŒé¢œè‰² */
        .hotness-tag {
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .hotness-tag.purple {
            background: linear-gradient(135deg, #8A2BE2, #9B30FF);
        }

        .hotness-tag.red {
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
        }

        .hotness-tag.orange {
            background: linear-gradient(135deg, #FFA500, #FF8C00);
        }

        .hotness-tag.gray {
            background: linear-gradient(135deg, #999999, #B0B0B0);
        }

        .hotness-tag.green {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
        }

        /* æ¨èæ ‡ç­¾ */
        .recommend-tag {
            background: linear-gradient(135deg, var(--recommend-blue), #357ABD);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: 8px;
        }

        .recommend-tag i {
            font-size: 10px;
        }

        .hotness-tag i, .recommend-tag i {
            font-size: 10px;
        }

        /* åˆ é™¤æ ‡è®° */
        .deleted-badge {
            background-color: #ff6b6b;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-right: 8px;
        }

        .deleted-badge i {
            font-size: 10px;
        }

        /* ç¼“å­˜æŒ‡ç¤ºå™¨ */
        .cache-indicator {
            background-color: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: 8px;
        }

        .cache-indicator i {
            font-size: 10px;
        }

        /* å†å²æ—¶é—´çº¿ */
        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: var(--border-color);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            background-color: var(--bg-primary);
            border-radius: var(--small-radius);
            padding: 16px;
            box-shadow: var(--card-shadow);
            cursor: pointer;
            transition: all 0.2s;
        }

        .timeline-item:hover {
            transform: translateX(4px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 20px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--primary-color);
            border: 3px solid var(--bg-primary);
        }

        .timeline-date {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .timeline-time {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-bottom: 8px;
        }

        .timeline-content {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .timeline-post {
            background-color: rgba(148, 13, 20, 0.05);
            border-left: 3px solid var(--primary-color);
        }

        .timeline-empty {
            text-align: center;
            padding: 40px;
            color: var(--text-tertiary);
        }

        .timeline-empty i {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--border-color);
        }

        /* è¯„è®ºåŒºåŸŸ */
        .comments-section {
            margin-top: 16px;
        }

        .comments-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .comment-count {
            background-color: var(--primary-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .comment-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .comment-item {
            display: flex;
            gap: 12px;
            padding: 16px;
            background-color: var(--bg-secondary);
            border-radius: var(--small-radius);
            transition: background-color 0.2s;
        }

        .comment-item:hover {
            background-color: var(--bg-tertiary);
        }

        .comment-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            flex-shrink: 0;
        }

        .comment-content {
            flex: 1;
        }

        .comment-header {
            display: flex;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 0;
        }

        .comment-username {
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }

        .comment-meta {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
            margin-left: auto;
            flex-shrink: 0;
        }

        .comment-time {
            color: var(--text-tertiary);
            font-size: 12px;
        }

        .comment-votes {
            color: var(--text-secondary);
            font-size: 12px;
            margin-left: auto;
        }

        .comment-text {
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
            flex: 1;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 24px;
            background-color: var(--bg-primary);
            border-radius: var(--card-radius);
            box-shadow: var(--card-shadow);
            width: 100%;
        }

        .empty-icon {
            font-size: 64px;
            color: var(--border-color);
            margin-bottom: 16px;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .empty-text {
            color: var(--text-tertiary);
            max-width: 400px;
            margin: 0 auto 24px;
        }

        /* å›åˆ°é¡¶éƒ¨æŒ‰é’® */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s;
            z-index: 999;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }

        .back-to-top.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .back-to-top:hover {
            background-color: var(--secondary-color);
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        /* åº•éƒ¨ä¿¡æ¯ */
        .footer {
            text-align: center;
            padding: 40px 24px 24px;
            color: var(--text-tertiary);
            font-size: 14px;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-bottom: 16px;
        }

        .footer-link {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-link:hover {
            color: var(--primary-color);
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px;
            background-color: var(--bg-primary);
            border-radius: var(--card-radius);
            box-shadow: var(--card-shadow);
            width: 100%;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        .loading-text {
            color: var(--text-secondary);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* å“åº”å¼è®¾è®¡ - ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .header {
                padding: 12px 16px;
            }
            
            .logo {
                font-size: 16px;
            }
            
            .main-container {
                padding: 16px;
            }
            
            .date-selector-container {
                padding: 20px;
            }
            
            .hole-card {
                padding: 16px;
            }
            
            .card-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .post-time {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }
            
            .post-time-info {
                margin-left: 0;
                width: 100%;
            }
            
            .file-stats {
                flex-direction: column;
                gap: 8px;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 12px;
            }
            
            /* ç§»åŠ¨ç«¯åªä½¿ç”¨ä¼ ç»Ÿå¸ƒå±€ */
            .split-layout {
                flex-direction: column;
            }
            
            .posts-container {
                max-width: 100%;
            }
            
            .right-panel {
                position: static;
                max-height: none;
                order: -1;
                min-height: 300px;
                margin-bottom: 20px;
            }
            
            .control-panel {
                flex-direction: column;
            }
            
            .control-group {
                width: 100%;
                justify-content: space-between;
            }
            
            .header-actions {
                flex-direction: column;
                gap: 8px;
                align-items: flex-end;
            }
            
            .toggle-group {
                width: 100%;
                justify-content: space-between;
            }
            
            .back-to-top {
                bottom: 20px;
                right: 20px;
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .modal-content {
                max-height: 95vh;
            }
            
            .feature-grid, .shortcut-grid {
                grid-template-columns: 1fr;
            }
            
            .date-selector-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .date-button {
                justify-content: center;
            }
            
            /* ç§»åŠ¨ç«¯éšè—åˆ†å±äº¤äº’é€‰é¡¹ */
            #splitInteractionGroup {
                display: none !important;
            }
            
            /* ç§»åŠ¨ç«¯é»˜è®¤ä½¿ç”¨ä¼ ç»Ÿå¸ƒå±€ */
            #layoutSelect option[value="split"] {
                display: none;
            }
            
            /* ç§»åŠ¨ç«¯æ—¥æœŸæ è°ƒæ•´ */
            .current-date-bar {
                padding: 10px 16px;
                font-size: 14px;
            }
            
            .current-date-display {
                font-size: 14px;
            }
            
            .date-bar-stats {
                display: none; /* ç§»åŠ¨ç«¯éšè—ç»Ÿè®¡ä¿¡æ¯èŠ‚çœç©ºé—´ */
            }
            
            /* ç§»åŠ¨ç«¯éšç§æç¤º */
            .privacy-notice-mobile {
                display: block !important;
                background-color: rgba(76, 175, 80, 0.1);
                border-left: 3px solid #4CAF50;
                border-radius: 4px;
                padding: 12px;
                margin: 16px 0;
                font-size: 12px;
                color: var(--text-secondary);
            }
        }

        /* ç‰¹æ®Šæ ·å¼ */
        .emoji {
            font-size: 1.2em;
            vertical-align: middle;
        }

        .mention {
            color: var(--primary-color);
            font-weight: 500;
        }

        .missed-post {
            opacity: 0.7;
            background-color: var(--bg-tertiary);
        }

        .missed-post .card-content {
            font-style: italic;
            color: var(--text-tertiary);
        }

        .deleted-post {
            background-color: rgba(255, 107, 107, 0.05);
            border-left: 4px solid #ff6b6b;
        }

        .hole-card.hidden {
            display: none;
        }

        /* éšç§æç¤º */
        .privacy-notice-mobile {
            display: none;
        }
        
        /* éšç§å¼ºè°ƒæ ·å¼ */
        .privacy-highlight {
            background-color: rgba(76, 175, 80, 0.1);
            border-left: 3px solid #4CAF50;
            padding: 16px;
            border-radius: 6px;
            margin: 16px 0;
        }
        
        .privacy-highlight i {
            color: #4CAF50;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <!-- å½“å‰æ—¥æœŸæ˜¾ç¤ºæ  -->
    <div class="current-date-bar" id="currentDateBar">
        <div class="date-bar-left">
            <span class="date-bar-title">å½“å‰æŸ¥çœ‹ï¼š</span>
            <span class="current-date-display" id="currentDateDisplay">æœªé€‰æ‹©æ—¥æœŸ</span>
        </div>
        <div class="date-bar-right">
            <div class="date-bar-stats" id="dateBarStats">
                <span>æ ‘æ´: <span id="dateBarPostCount">0</span></span>
                <span>è¯„è®º: <span id="dateBarCommentCount">0</span></span>
            </div>
            <button class="date-bar-close" id="hideDateBarBtn" title="éšè—æ—¥æœŸæ ">
                <i class="fas fa-chevron-up"></i>
            </button>
        </div>
    </div>

    <!-- å…³äºé¡µé¢æ¨¡æ€æ¡† -->
    <div class="modal" id="aboutModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-info-circle"></i>
                    å…³äºåŒ—äº¬å¤§å­¦æ ‘æ´æ¡£æ¡ˆé¦†
                </div>
                <button class="modal-close" id="closeAboutBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h3><i class="fas fa-book"></i> é¡¹ç›®ä»‹ç»</h3>
                    <p>åŒ—äº¬å¤§å­¦æ ‘æ´æ¡£æ¡ˆé¦†æ˜¯ä¸€ä¸ªä¿å­˜å’Œå±•ç¤ºåŒ—äº¬å¤§å­¦æ ‘æ´å†å²æ•°æ®çš„é¡¹ç›®ã€‚æ ‘æ´æ˜¯åŒ—äº¬å¤§å­¦å­¦ç”ŸåŒ¿åäº¤æµçš„å¹³å°ï¼Œè¿™é‡Œå­˜æ¡£äº†ä»2013å¹´åˆ°2019å¹´çš„å†å²æ•°æ®ã€‚</p>
                    <p>æœ¬é¡¹ç›®è‡´åŠ›äºå¯è§†åŒ–è¿™äº›çè´µçš„å†å²æ•°æ®ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿå›é¡¾è¿‡å»çš„è®¨è®ºã€‚</p>
                    
                    <div class="privacy-highlight">
                        <p><i class="fas fa-shield-alt"></i> <strong>éšç§å£°æ˜ï¼š</strong>æ‰€æœ‰æµè§ˆæ•°æ®ï¼ˆåŒ…æ‹¬å†å²è®°å½•ã€ç”¨æˆ·åå¥½ç­‰ï¼‰ä»…å­˜å‚¨åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°ï¼ˆlocalStorageï¼‰ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚ç½‘ç»œè¯·æ±‚ä»…é™äºä»GitHubä»“åº“è·å–å†å²å¸–å­æ•°æ®ã€‚</p>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3><i class="fas fa-star"></i> ä¸»è¦åŠŸèƒ½</h3>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-sort-amount-down"></i>
                            </div>
                            <div class="feature-text">
                                <div class="feature-title">å¤šç§æ’åºæ–¹å¼</div>
                                <div class="feature-desc">æŒ‰æ—¶é—´ã€çƒ­åº¦ã€è¯„è®ºæ•°ã€å›´è§‚æ•°æ’åº</div>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-columns"></i>
                            </div>
                            <div class="feature-text">
                                <div class="feature-title">æ™ºèƒ½æ¨è</div>
                                <div class="feature-desc">åŸºäºæµè§ˆå†å²çš„ä¸ªæ€§åŒ–æ¨è</div>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-fire"></i>
                            </div>
                            <div class="feature-text">
                                <div class="feature-title">çƒ­åº¦ç®—æ³•</div>
                                <div class="feature-desc">æ™ºèƒ½è®¡ç®—å¸–å­çƒ­åº¦ï¼Œå‘ç°ä¼˜è´¨å†…å®¹</div>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-history"></i>
                            </div>
                            <div class="feature-text">
                                <div class="feature-title">å†å²æ—¶é—´çº¿</div>
                                <div class="feature-desc">è®°å½•æ‚¨çš„æµè§ˆå†å²ï¼Œå¿«é€Ÿè·³è½¬</div>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="feature-text">
                                <div class="feature-title">æœ¬åœ°ç¼“å­˜</div>
                                <div class="feature-desc">ç¼“å­˜å·²è®¿é—®æ•°æ®ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚</div>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-filter"></i>
                            </div>
                            <div class="feature-text">
                                <div class="feature-title">å†…å®¹è¿‡æ»¤</div>
                                <div class="feature-desc">è¿‡æ»¤è¢«åˆ é™¤å’Œç¼ºå¤±çš„å¸–å­</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3><i class="fas fa-gamepad"></i> æ“ä½œæŒ‡å—</h3>
                    <h4>åŸºæœ¬æ“ä½œ</h4>
                    <p>1. é€‰æ‹©æ—¥æœŸå¹¶ç‚¹å‡»"åŠ è½½"æŒ‰é’®æŸ¥çœ‹è¯¥æ—¥æœŸçš„æ ‘æ´</p>
                    <p>2. ä½¿ç”¨"å‰ä¸€å¤©"å’Œ"åä¸€å¤©"æŒ‰é’®å¿«é€Ÿåˆ‡æ¢æ—¥æœŸ</p>
                    <p>3. åœ¨æ§åˆ¶é¢æ¿ä¸­é€‰æ‹©æ’åºæ–¹å¼å’Œå¸ƒå±€æ¨¡å¼</p>
                    <p>4. ç‚¹å‡»å¸–å­æŸ¥çœ‹è¯¦ç»†å†…å®¹å’Œè¯„è®º</p>
                    
                    <h4>åˆ†å±å¸ƒå±€ï¼ˆæ¡Œé¢ç«¯ï¼‰</h4>
                    <p>â€¢ å·¦ä¾§æ˜¾ç¤ºå¸–å­åˆ—è¡¨ï¼Œå³ä¾§æ˜¾ç¤ºé€‰ä¸­å¸–å­çš„è¯¦ç»†å†…å®¹å’Œè¯„è®º</p>
                    <p>â€¢ æ”¯æŒç‚¹å‡»å±•å¼€å’Œé¼ æ ‡æ‚¬åœä¸¤ç§äº¤äº’æ¨¡å¼</p>
                    <p>â€¢ ç‚¹å‡»å¸–å­æ—¶è‡ªåŠ¨æ»šåŠ¨åˆ°åˆé€‚ä½ç½®</p>
                    
                    <h4>å¿«æ·é”®</h4>
                    <div class="shortcut-grid">
                        <div class="shortcut-item">
                            <span class="shortcut-action">ä¸Šä¸€ä¸ªå¸–å­</span>
                            <kbd class="shortcut-key">â†‘ / K</kbd>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-action">ä¸‹ä¸€ä¸ªå¸–å­</span>
                            <kbd class="shortcut-key">â†“ / J</kbd>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-action">æ‰“å¼€/å…³é—­è¯„è®º</span>
                            <kbd class="shortcut-key">ç©ºæ ¼</kbd>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-action">å›åˆ°é¡¶éƒ¨</span>
                            <kbd class="shortcut-key">Home</kbd>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-action">åˆ°åº•éƒ¨</span>
                            <kbd class="shortcut-key">End</kbd>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-action">åˆ‡æ¢å¸ƒå±€</span>
                            <kbd class="shortcut-key">L</kbd>
                        </div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3><i class="fas fa-code"></i> æŠ€æœ¯ç»†èŠ‚</h3>
                    <p><strong>çƒ­åº¦ç®—æ³•ï¼š</strong>çƒ­åº¦ = è¯„è®ºæ•° Ã— 1.2 + å›´è§‚æ•° Ã— 1.5</p>
                    <p><strong>çƒ­åº¦åˆ†çº§ï¼š</strong>å‰1%ç´«è‰²ï¼Œ1%-5%çº¢è‰²ï¼Œ5%-20%æ©™è‰²ï¼Œ20%-99%ç°è‰²ï¼Œçƒ­åº¦1.0ç»¿è‰²</p>
                    <p><strong>æ¨èç®—æ³•ï¼š</strong>åŸºäºTF-IDFå’Œä½™å¼¦ç›¸ä¼¼åº¦çš„æ··åˆæ¨èï¼Œæƒé‡ä¸º0.15</p>
                    <p><strong>æ•°æ®æ¥æºï¼š</strong>åŸå§‹æ•°æ®æ¥è‡ªGitHubç”¨æˆ·woct0rdhoçš„çè´µå­˜æ¡£pkuholebackupï¼ŒåŒ…å«2013å¹´12æœˆ15æ—¥è‡³2019å¹´11æœˆ24æ—¥çš„æ•°æ®</p>
                    <p><strong>éšç§ä¿æŠ¤ï¼š</strong>æ‰€æœ‰ç”¨æˆ·æ•°æ®æœ¬åœ°å­˜å‚¨ï¼Œä¸ä¸Šä¼ ä»»ä½•æµè§ˆè®°å½•æˆ–ä¸ªäººä¿¡æ¯</p>
                </div>
            </div>
        </div>
    </div>

    <!-- å†å²æ—¶é—´çº¿æ¨¡æ€æ¡† -->
    <div class="modal" id="historyModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-history"></i>
                    å†å²æ—¶é—´çº¿
                </div>
                <button class="modal-close" id="closeHistoryBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <h3 style="margin: 0;">æ‚¨çš„æµè§ˆå†å²</h3>
                        <p style="color: var(--text-tertiary); font-size: 14px; margin-top: 4px;">ç‚¹å‡»è®°å½•å¯å¿«é€Ÿè·³è½¬</p>
                    </div>
                    <button id="clearHistoryBtn" style="padding: 8px 16px; background-color: var(--bg-tertiary); color: var(--text-secondary); border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                        <i class="fas fa-trash"></i> æ¸…é™¤å†å²
                    </button>
                </div>
                
                <div class="timeline" id="timelineContainer">
                    <!-- æ—¶é—´çº¿å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
    <button class="back-to-top" id="backToTopBtn">
        <i class="fas fa-chevron-up"></i>
    </button>

    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <div class="header">
        <div class="logo">
            <span>PKU Hole Archive åŒ—å¤§æ ‘æ´æ¡£æ¡ˆé¦†</span>
        </div>
        <div class="header-actions">
            <button class="header-btn" id="aboutBtn">
                <i class="fas fa-info-circle"></i>
                <span>å…³äº</span>
            </button>
            <button class="header-btn" id="historyBtn">
                <i class="fas fa-history"></i>
                <span>å†å²æ—¶é—´çº¿</span>
            </button>
            <div class="toggle-group">
                <span class="toggle-label">å±•ç¤ºç¼ºå¤±å¸–å­</span>
                <button class="toggle-switch" id="toggleMissedBtn"></button>
            </div>
            <div class="toggle-group">
                <span class="toggle-label">å±•ç¤ºè¢«åˆ å¸–å­</span>
                <button class="toggle-switch active" id="toggleDeletedBtn"></button>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="main-container">
        <!-- æ—¥æœŸé€‰æ‹©åŒºåŸŸ - æ”¹è¿›ç‰ˆ -->
        <div class="date-selector-container">
            <div class="date-selector-title">
                <i class="fas fa-calendar-alt"></i> é€‰æ‹©æ—¥æœŸ
            </div>
            
            <div class="date-selector-grid">
                <div class="mode-indicator" id="modeIndicator">
                    <span id="modeText">ğŸ“ æœ¬åœ°æ¨¡å¼</span>
                    <button id="modeToggle" class="mode-toggle">åˆ‡æ¢</button>
                </div>
                
                <div class="date-input-wrapper">
                    <label class="date-input-label">é€‰æ‹©æ—¥æœŸ</label>
                    <input type="date" id="dateInput" class="date-input" title="é€‰æ‹©æ—¥æœŸèŒƒå›´: 2013-12-15 åˆ° 2019-11-24">
                </div>
                
                <button id="loadBtn" class="date-button primary">
                    <i class="fas fa-download"></i> åŠ è½½
                </button>
                
                <button id="prevDayBtn" class="date-button secondary small" title="åŠ è½½å‰ä¸€å¤©">
                    <i class="fas fa-chevron-left"></i>
                </button>
                
                <button id="nextDayBtn" class="date-button secondary small" title="åŠ è½½åä¸€å¤©">
                    <i class="fas fa-chevron-right"></i>
                </button>
                
                <button id="clearCacheBtn" class="date-button secondary" title="æ¸…é™¤ç¼“å­˜">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
            
            <div class="date-info">
                <i class="fas fa-info-circle"></i>
                å¯é€‰æ—¥æœŸèŒƒå›´: <span class="date-range">2013-12-15</span> è‡³ <span class="date-range">2019-11-24</span>
            </div>
            
            <!-- ç§»åŠ¨ç«¯éšç§æç¤º -->
            <div class="privacy-notice-mobile">
                <i class="fas fa-shield-alt"></i> æ‰€æœ‰æµè§ˆæ•°æ®ä»…å­˜å‚¨åœ¨æ‚¨çš„è®¾å¤‡æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚
            </div>
            
            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="control-panel" style="margin-top: 20px;">
                <!-- æ’åºæ§åˆ¶ -->
                <div class="control-group">
                    <span class="control-label">æ’åºæ–¹å¼ï¼š</span>
                    <select id="sortSelect" class="sort-select">
                        <option value="hotness" selected>æŒ‰çƒ­åº¦æ’åº</option>
                        <option value="time_desc">æŒ‰æ—¶é—´å€’åº</option>
                        <option value="time_asc">æŒ‰æ—¶é—´æ­£åº</option>
                        <option value="comments">æŒ‰è¯„è®ºæ•°æ’åº</option>
                        <option value="watches">æŒ‰å›´è§‚æ•°æ’åº</option>
                        <option value="recommend">æ™ºèƒ½æ¨è</option>
                    </select>
                </div>
                
                <!-- å¸ƒå±€æ§åˆ¶ï¼ˆç§»åŠ¨ç«¯éšè—åˆ†å±é€‰é¡¹ï¼‰ -->
                <div class="control-group">
                    <span class="control-label">å¸ƒå±€æ¨¡å¼ï¼š</span>
                    <select id="layoutSelect" class="sort-select">
                        <option value="split" selected>åˆ†å±å¸ƒå±€</option>
                        <option value="traditional">ä¼ ç»Ÿå¸ƒå±€</option>
                    </select>
                </div>
                
                <!-- åˆ†å±å¸ƒå±€äº¤äº’æ¨¡å¼ -->
                <div class="control-group" id="splitInteractionGroup">
                    <span class="control-label">åˆ†å±äº¤äº’ï¼š</span>
                    <select id="interactionSelect" class="sort-select">
                        <option value="click">ç‚¹å‡»å±•å¼€</option>
                        <option value="hover">é¼ æ ‡æ‚¬åœ</option>
                    </select>
                </div>
            </div>
            
            <div class="file-info" id="fileInfo" style="display: none;">
                <div class="file-name" id="fileName">æœªé€‰æ‹©æ—¥æœŸ</div>
                <div class="file-stats">
                    <span id="postCount">æ ‘æ´: 0</span>
                    <span id="commentCount">è¯„è®º: 0</span>
                    <span id="cacheIndicator"></span>
                </div>
            </div>
        </div>

        <!-- åˆå§‹ç©ºçŠ¶æ€ -->
        <div class="empty-state" id="emptyState">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">
                    <i class="fas fa-folder-open"></i>
                </div>
                <div class="upload-text">ç‚¹å‡»ä¸Šæ–¹ã€åŠ è½½ã€‘åŒ—å¤§æ ‘æ´æ¡£æ¡ˆ</div>
                <div class="upload-subtext">
                    é€‰æ‹©æ—¥æœŸåŠ è½½åŒ—äº¬å¤§å­¦æ ‘æ´çš„å†å²è®°å½•
                </div>
            </div>
        </div>

        <!-- æ ‘æ´å†…å®¹å®¹å™¨ - åˆ†å±å¸ƒå±€ -->
        <div class="split-layout" id="splitLayout" style="display: none;">
            <!-- å³ä¾§é¢æ¿ï¼šå¸–å­è¯¦æƒ…å’Œè¯„è®º -->
            <div class="right-panel" id="rightPanel">
                <div class="right-panel-header">
                    <div class="right-panel-title">
                        <i class="fas fa-file-alt"></i> å¸–å­è¯¦æƒ…
                    </div>
                    <button class="right-panel-close" id="closeRightPanelBtn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="right-panel-content" id="rightPanelContent">
                    <div class="empty-panel">
                        <div class="empty-panel-icon">
                            <i class="fas fa-mouse-pointer"></i>
                        </div>
                        <div class="empty-panel-title">é€‰æ‹©å·¦ä¾§çš„å¸–å­æŸ¥çœ‹è¯¦æƒ…</div>
                        <div class="empty-panel-text">ç‚¹å‡»æˆ–æ‚¬åœå·¦ä¾§çš„å¸–å­å¡ç‰‡ï¼Œè¿™é‡Œå°†æ˜¾ç¤ºå®Œæ•´çš„å¸–å­å†…å®¹å’Œæ‰€æœ‰è¯„è®º</div>
                    </div>
                </div>
            </div>

            <!-- å·¦ä¾§ï¼šå¸–å­åˆ—è¡¨ -->
            <div class="posts-container" id="postsContainer">
                <!-- å¸–å­åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
                <div class="posts-scroll-area" id="postsScrollArea"></div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨ä¿¡æ¯ -->
    <div class="footer">
        <div>åŒ—äº¬å¤§å­¦æ ‘æ´æ¡£æ¡ˆé¦† Â· 2013 - 2026</div>
        <div># æ•°æ®æ¥æºï¼š<a href="https://github.com/woct0rdho/pkuholebackup">GitHubä»“åº“pkuholebackup</a>
        <div># å·²ç¼“å­˜ï¼š<span id="cacheStats">0</span> å¤©çš„æ•°æ® | å†å²è®°å½•ï¼š<span id="historyStats">0</span> æ¡</div>
        <div># å¿«æ·é”®ï¼šâ†‘/â†“ æµè§ˆå¸–å­ | ç©ºæ ¼ å±•å¼€/å…³é—­è¯„è®º | L åˆ‡æ¢å¸ƒå±€</div>
        <div style="margin-top: 8px; font-size: 12px; color: var(--text-tertiary);">
            <i class="fas fa-shield-alt"></i> éšç§ä¿æŠ¤ï¼šæ‰€æœ‰æµè§ˆæ•°æ®ä»…å­˜å‚¨åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentData = {
            date: null,
            posts: [],
            stats: {
                totalPosts: 0,
                totalComments: 0,
                dateRange: null
            }
        };
        let currentDate = null;
        let showMissedPosts = false; // é»˜è®¤ä¸æ˜¾ç¤ºæ•°æ®åº“ä¸­ç¼ºå¤±çš„å¸–å­
        let showDeletedPosts = true; // é»˜è®¤æ˜¾ç¤ºè¢«åˆ é™¤çš„å¸–å­
        let isOnlineMode = false; // é»˜è®¤æœ¬åœ°æ¨¡å¼
        let currentSortMethod = 'hotness'; // é»˜è®¤æŒ‰çƒ­åº¦æ’åº
        let currentLayout = 'split'; // é»˜è®¤åˆ†å±å¸ƒå±€
        let currentInteraction = 'click'; // åˆ†å±å¸ƒå±€äº¤äº’æ¨¡å¼
        let activePostId = null; // å½“å‰æ¿€æ´»çš„å¸–å­ID
        let useCache = true; // æ˜¯å¦ä½¿ç”¨ç¼“å­˜
        let userPreferenceVector = null; // ç”¨æˆ·åå¥½å‘é‡ï¼ˆç”¨äºç®—æ³•æ¨èï¼‰
        let isMobile = false; // æ˜¯å¦ç§»åŠ¨è®¾å¤‡
        let dateBarVisible = true; // æ—¥æœŸæ æ˜¯å¦å¯è§

        // ç¼“å­˜å’Œå†å²è®°å½•ç›¸å…³
        const CACHE_PREFIX = 'pku_hole_cache_';
        const HISTORY_KEY = 'pku_hole_history';
        const USER_PREFERENCE_KEY = 'pku_hole_user_preference';
        const DATE_BAR_VISIBLE_KEY = 'pku_hole_date_bar_visible';
        const CACHE_EXPIRY_DAYS = 30; // ç¼“å­˜è¿‡æœŸå¤©æ•°
        const MAX_HISTORY_ITEMS = 200; // æœ€å¤§å†å²è®°å½•æ•°
        const RECOMMEND_WEIGHT = 0.15; // æ¨èç®—æ³•æƒé‡ï¼ˆ15%ï¼‰

        // DOM å…ƒç´ 
        const currentDateBar = document.getElementById('currentDateBar');
        const currentDateDisplay = document.getElementById('currentDateDisplay');
        const dateBarPostCount = document.getElementById('dateBarPostCount');
        const dateBarCommentCount = document.getElementById('dateBarCommentCount');
        const hideDateBarBtn = document.getElementById('hideDateBarBtn');
        const dateInput = document.getElementById('dateInput');
        const loadBtn = document.getElementById('loadBtn');
        const modeToggle = document.getElementById('modeToggle');
        const modeText = document.getElementById('modeText');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const postCount = document.getElementById('postCount');
        const commentCount = document.getElementById('commentCount');
        const cacheIndicator = document.getElementById('cacheIndicator');
        const postsContainer = document.getElementById('postsContainer');
        const emptyState = document.getElementById('emptyState');
        const uploadArea = document.getElementById('uploadArea');
        const prevDayBtn = document.getElementById('prevDayBtn');
        const nextDayBtn = document.getElementById('nextDayBtn');
        const toggleMissedBtn = document.getElementById('toggleMissedBtn');
        const toggleDeletedBtn = document.getElementById('toggleDeletedBtn');
        const sortSelect = document.getElementById('sortSelect');
        const layoutSelect = document.getElementById('layoutSelect');
        const interactionSelect = document.getElementById('interactionSelect');
        const splitInteractionGroup = document.getElementById('splitInteractionGroup');
        const rightPanel = document.getElementById('rightPanel');
        const rightPanelContent = document.getElementById('rightPanelContent');
        const closeRightPanelBtn = document.getElementById('closeRightPanelBtn');
        const splitLayout = document.getElementById('splitLayout');
        const backToTopBtn = document.getElementById('backToTopBtn');
        const postsScrollArea = document.getElementById('postsScrollArea');
        const aboutBtn = document.getElementById('aboutBtn');
        const aboutModal = document.getElementById('aboutModal');
        const closeAboutBtn = document.getElementById('closeAboutBtn');
        const historyBtn = document.getElementById('historyBtn');
        const historyModal = document.getElementById('historyModal');
        const closeHistoryBtn = document.getElementById('closeHistoryBtn');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const clearCacheBtn = document.getElementById('clearCacheBtn');
        const timelineContainer = document.getElementById('timelineContainer');
        const cacheStats = document.getElementById('cacheStats');
        const historyStats = document.getElementById('historyStats');

        // æ£€æµ‹è®¾å¤‡ç±»å‹
        function detectDevice() {
            isMobile = window.innerWidth <= 768;
            
            // ç§»åŠ¨ç«¯é»˜è®¤ä½¿ç”¨ä¼ ç»Ÿå¸ƒå±€
            if (isMobile) {
                currentLayout = 'traditional';
                layoutSelect.value = 'traditional';
                splitInteractionGroup.style.display = 'none';
                
                // éšè—åˆ†å±é€‰é¡¹
                const splitOption = document.querySelector('#layoutSelect option[value="split"]');
                if (splitOption) splitOption.style.display = 'none';
            }
        }

        // æ›´æ–°æ—¥æœŸæ æ˜¾ç¤º
        function updateDateBar(dateStr, postCount, commentCount) {
            if (!dateStr) return;
            
            const year = dateStr.substring(0, 4);
            const month = dateStr.substring(4, 6);
            const day = dateStr.substring(6, 8);
            const displayDate = `${year}å¹´${month}æœˆ${day}æ—¥`;
            
            currentDateDisplay.textContent = displayDate;
            dateBarPostCount.textContent = postCount;
            dateBarCommentCount.textContent = commentCount;
            
            if (dateBarVisible) {
                currentDateBar.classList.add('visible');
            }
        }

        // åˆ‡æ¢æ—¥æœŸæ æ˜¾ç¤º
        function toggleDateBar() {
            dateBarVisible = !dateBarVisible;
            if (dateBarVisible) {
                currentDateBar.classList.add('visible');
            } else {
                currentDateBar.classList.remove('visible');
            }
            
            // ä¿å­˜åå¥½
            try {
                localStorage.setItem(DATE_BAR_VISIBLE_KEY, JSON.stringify(dateBarVisible));
            } catch (e) {
                console.error('ä¿å­˜æ—¥æœŸæ æ˜¾ç¤ºçŠ¶æ€æ—¶å‡ºé”™:', e);
            }
        }

        // åˆå§‹åŒ–ç¼“å­˜å’Œç»Ÿè®¡
        function initCacheAndStats() {
            updateCacheStats();
            updateHistoryStats();
            loadUserPreference();
            loadDateBarPreference();
        }

        // åŠ è½½æ—¥æœŸæ æ˜¾ç¤ºåå¥½
        function loadDateBarPreference() {
            try {
                const saved = localStorage.getItem(DATE_BAR_VISIBLE_KEY);
                if (saved !== null) {
                    dateBarVisible = JSON.parse(saved);
                    if (dateBarVisible) {
                        currentDateBar.classList.add('visible');
                    }
                }
            } catch (e) {
                console.error('åŠ è½½æ—¥æœŸæ æ˜¾ç¤ºçŠ¶æ€æ—¶å‡ºé”™:', e);
            }
        }

        // åŠ è½½ç”¨æˆ·åå¥½å‘é‡
        function loadUserPreference() {
            try {
                const pref = localStorage.getItem(USER_PREFERENCE_KEY);
                if (pref) {
                    userPreferenceVector = JSON.parse(pref);
                    console.log(`åŠ è½½ç”¨æˆ·åå¥½å‘é‡ï¼ŒåŒ…å« ${Object.keys(userPreferenceVector).length} ä¸ªè¯é¡¹`);
                } else {
                    userPreferenceVector = {};
                    console.log('åˆå§‹åŒ–æ–°çš„ç”¨æˆ·åå¥½å‘é‡');
                }
            } catch (e) {
                console.error('åŠ è½½ç”¨æˆ·åå¥½æ—¶å‡ºé”™:', e);
                userPreferenceVector = {};
            }
        }

        // ä¿å­˜ç”¨æˆ·åå¥½å‘é‡
        function saveUserPreference() {
            try {
                localStorage.setItem(USER_PREFERENCE_KEY, JSON.stringify(userPreferenceVector));
            } catch (e) {
                console.error('ä¿å­˜ç”¨æˆ·åå¥½æ—¶å‡ºé”™:', e);
            }
        }

        // æ›´æ–°ç”¨æˆ·åå¥½å‘é‡ï¼ˆåŸºäºç‚¹å‡»çš„å¸–å­ï¼‰- å·¥ä¸šçº§TF-IDFç®€åŒ–ç‰ˆ
        function updateUserPreference(postContent) {
            if (!postContent || postContent === '#MISSED') return;
            
            // 1. ä¸­æ–‡åˆ†è¯ï¼ˆç®€åŒ–ç‰ˆï¼šæŒ‰å­—ç¬¦åˆ†å‰²ï¼Œè¿‡æ»¤åœç”¨è¯ï¼‰
            const stopWords = new Set(['çš„', 'äº†', 'åœ¨', 'æ˜¯', 'æˆ‘', 'æœ‰', 'å’Œ', 'å°±', 'ä¸', 'äºº', 'éƒ½', 'ä¸€', 'ä¸€ä¸ª', 'ä¸Š', 'ä¹Ÿ', 'å¾ˆ', 'åˆ°', 'è¯´', 'è¦', 'å»', 'ä½ ', 'ä¼š', 'ç€', 'æ²¡æœ‰', 'çœ‹', 'å¥½', 'è‡ªå·±', 'è¿™']);
            
            // ç§»é™¤æ ‡ç‚¹ç¬¦å·å’Œç‰¹æ®Šå­—ç¬¦ï¼Œä¿ç•™ä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—
            const cleanedContent = postContent
                .replace(/[^\u4e00-\u9fa5a-zA-Z0-9\s]/g, ' ')
                .toLowerCase();
            
            // ç®€å•çš„æŒ‰ç©ºæ ¼åˆ†å‰²ï¼ˆè‹±æ–‡ï¼‰å’ŒæŒ‰å­—ç¬¦åˆ†å‰²ï¼ˆä¸­æ–‡ï¼‰
            const words = [];
            const tokens = cleanedContent.split(/\s+/);
            
            tokens.forEach(token => {
                if (/^[\u4e00-\u9fa5]+$/.test(token)) {
                    // ä¸­æ–‡ï¼šæŒ‰å­—ç¬¦åˆ†å‰²
                    for (let i = 0; i < token.length; i++) {
                        const char = token[i];
                        if (!stopWords.has(char) && char.length > 0) {
                            words.push(char);
                        }
                    }
                } else if (/^[a-zA-Z0-9]+$/.test(token) && token.length > 2) {
                    // è‹±æ–‡ï¼šé•¿åº¦å¤§äº2çš„å•è¯
                    if (!stopWords.has(token)) {
                        words.push(token);
                    }
                }
            });
            
            // 2. æ›´æ–°è¯é¢‘ï¼Œä½¿ç”¨æŒ‡æ•°è¡°å‡ï¼ˆæ–°è¯æƒé‡æ›´é«˜ï¼‰
            const decayFactor = 0.95; // æ—§è¯è¡°å‡å› å­
            
            // å…ˆè¡°å‡ç°æœ‰å‘é‡
            Object.keys(userPreferenceVector).forEach(word => {
                userPreferenceVector[word] *= decayFactor;
            });
            
            // æ·»åŠ æ–°è¯
            words.forEach(word => {
                if (userPreferenceVector[word]) {
                    userPreferenceVector[word] += 1;
                } else {
                    userPreferenceVector[word] = 1;
                }
            });
            
            // 3. å½’ä¸€åŒ–å¤„ç†
            let maxFreq = 0;
            Object.values(userPreferenceVector).forEach(freq => {
                if (freq > maxFreq) maxFreq = freq;
            });
            
            if (maxFreq > 0) {
                Object.keys(userPreferenceVector).forEach(word => {
                    userPreferenceVector[word] = userPreferenceVector[word] / maxFreq;
                });
            }
            
            // 4. é™åˆ¶å‘é‡å¤§å°ï¼Œåªä¿ç•™å‰200ä¸ªæœ€é‡è¦çš„è¯
            const sortedEntries = Object.entries(userPreferenceVector)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 200);
            
            userPreferenceVector = Object.fromEntries(sortedEntries);
            saveUserPreference();
            
            console.log(`æ›´æ–°ç”¨æˆ·åå¥½å‘é‡ï¼Œå½“å‰åŒ…å« ${Object.keys(userPreferenceVector).length} ä¸ªè¯é¡¹`);
        }

        // è®¡ç®—å¸–å­ä¸ç”¨æˆ·åå¥½çš„ç›¸ä¼¼åº¦ï¼ˆæ”¹è¿›ç‰ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰
        function calculateSimilarity(postContent) {
            if (!userPreferenceVector || Object.keys(userPreferenceVector).length === 0) {
                return 0;
            }
            
            // åŒæ ·æ–¹å¼å¤„ç†å¸–å­å†…å®¹
            const stopWords = new Set(['çš„', 'äº†', 'åœ¨', 'æ˜¯', 'æˆ‘', 'æœ‰', 'å’Œ', 'å°±', 'ä¸', 'äºº', 'éƒ½', 'ä¸€', 'ä¸€ä¸ª', 'ä¸Š', 'ä¹Ÿ', 'å¾ˆ', 'åˆ°', 'è¯´', 'è¦', 'å»', 'ä½ ', 'ä¼š', 'ç€', 'æ²¡æœ‰', 'çœ‹', 'å¥½', 'è‡ªå·±', 'è¿™']);
            
            const cleanedContent = postContent
                .replace(/[^\u4e00-\u9fa5a-zA-Z0-9\s]/g, ' ')
                .toLowerCase();
            
            const postVector = {};
            const tokens = cleanedContent.split(/\s+/);
            let totalWords = 0;
            
            tokens.forEach(token => {
                if (/^[\u4e00-\u9fa5]+$/.test(token)) {
                    for (let i = 0; i < token.length; i++) {
                        const char = token[i];
                        if (!stopWords.has(char) && char.length > 0) {
                            postVector[char] = (postVector[char] || 0) + 1;
                            totalWords++;
                        }
                    }
                } else if (/^[a-zA-Z0-9]+$/.test(token) && token.length > 2) {
                    if (!stopWords.has(token)) {
                        postVector[token] = (postVector[token] || 0) + 1;
                        totalWords++;
                    }
                }
            });
            
            // è®¡ç®—TF-IDFåŠ æƒï¼ˆç®€åŒ–ç‰ˆï¼‰
            const postTFIDF = {};
            Object.entries(postVector).forEach(([word, freq]) => {
                // TF (è¯é¢‘)
                const tf = freq / Math.max(totalWords, 1);
                // IDF (é€†æ–‡æ¡£é¢‘ç‡ï¼Œç®€åŒ–ç‰ˆï¼šä½¿ç”¨ç”¨æˆ·åå¥½ä¸­çš„æƒé‡)
                const idf = userPreferenceVector[word] || 0.1;
                postTFIDF[word] = tf * idf;
            });
            
            // è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
            let dotProduct = 0;
            let userNorm = 0;
            let postNorm = 0;
            
            // è®¡ç®—ç‚¹ç§¯å’Œç”¨æˆ·å‘é‡æ¨¡é•¿
            Object.entries(userPreferenceVector).forEach(([word, weight]) => {
                userNorm += weight * weight;
                if (postTFIDF[word]) {
                    dotProduct += weight * postTFIDF[word];
                }
            });
            
            // è®¡ç®—å¸–å­å‘é‡æ¨¡é•¿
            Object.values(postTFIDF).forEach(weight => {
                postNorm += weight * weight;
            });
            
            userNorm = Math.sqrt(userNorm);
            postNorm = Math.sqrt(postNorm);
            
            if (userNorm === 0 || postNorm === 0) {
                return 0;
            }
            
            const similarity = dotProduct / (userNorm * postNorm);
            
            // åº”ç”¨sigmoidå‡½æ•°å¹³æ»‘è¾“å‡º
            return 1 / (1 + Math.exp(-5 * (similarity - 0.5)));
        }

        // æ¨èç®—æ³•ï¼šæ··åˆæ’åºï¼ˆåŸºäºå½“å‰æ’åºæ–¹å¼ï¼ŒåŠ å…¥æ¨èæƒé‡ï¼‰
        function applyRecommendationAlgorithm(posts, baseSortMethod) {
            if (baseSortMethod === 'recommend') {
                // å¦‚æœæ˜¯æ¨èæ¨¡å¼ï¼Œå®Œå…¨æŒ‰ç›¸ä¼¼åº¦æ’åº
                return posts.map(post => {
                    if (!post.isMissed && !post.isDeleted) {
                        post.similarity = calculateSimilarity(post.content);
                    } else {
                        post.similarity = 0;
                    }
                    return post;
                }).sort((a, b) => {
                    // ç¼ºå¤±å’Œè¢«åˆ é™¤çš„å¸–å­æ”¾æœ€å
                    if (a.isMissed && !b.isMissed) return 1;
                    if (!a.isMissed && b.isMissed) return -1;
                    if (a.isDeleted && !b.isDeleted) return 1;
                    if (!a.isDeleted && b.isDeleted) return -1;
                    
                    return b.similarity - a.similarity;
                });
            } else {
                // æ··åˆæ’åºï¼šåŸºäºå½“å‰æ’åºï¼ŒåŠ å…¥æ¨èæƒé‡
                const postsWithScore = posts.map(post => {
                    // è®¡ç®—åŸºç¡€åˆ†æ•°
                    let baseScore = 0;
                    
                    switch(baseSortMethod) {
                        case 'hotness':
                            baseScore = parseFloat(post.hotness) || 0;
                            break;
                        case 'time_desc':
                            baseScore = post.id; // æ—¶é—´å€’åºï¼šIDè¶Šå¤§åˆ†æ•°è¶Šé«˜
                            break;
                        case 'time_asc':
                            baseScore = -post.id; // æ—¶é—´æ­£åºï¼šIDè¶Šå°åˆ†æ•°è¶Šé«˜
                            break;
                        case 'comments':
                            baseScore = post.comments.length;
                            break;
                        case 'watches':
                            baseScore = Math.abs(post.watches) || 0;
                            break;
                        default:
                            baseScore = parseFloat(post.hotness) || 0;
                    }
                    
                    // è®¡ç®—æ¨èåˆ†æ•°
                    let recommendScore = 0;
                    if (!post.isMissed && !post.isDeleted) {
                        recommendScore = calculateSimilarity(post.content);
                        post.similarity = recommendScore;
                    }
                    
                    // æ··åˆåˆ†æ•°ï¼šbaseScore * (1 - weight) + recommendScore * weight
                    const totalScore = baseScore * (1 - RECOMMEND_WEIGHT) + recommendScore * RECOMMEND_WEIGHT * 100;
                    
                    return {
                        ...post,
                        _sortScore: totalScore,
                        _baseScore: baseScore,
                        _recommendScore: recommendScore
                    };
                });
                
                // æŒ‰æ€»åˆ†æ•°æ’åº
                return postsWithScore.sort((a, b) => {
                    // ç¼ºå¤±å’Œè¢«åˆ é™¤çš„å¸–å­æ”¾æœ€å
                    if (a.isMissed && !b.isMissed) return 1;
                    if (!a.isMissed && b.isMissed) return -1;
                    if (a.isDeleted && !b.isDeleted) return 1;
                    if (!a.isDeleted && b.isDeleted) return -1;
                    
                    return b._sortScore - a._sortScore;
                }).map(({_sortScore, _baseScore, _recommendScore, ...post}) => post);
            }
        }

        // æ›´æ–°ç¼“å­˜ç»Ÿè®¡
        function updateCacheStats() {
            let cacheCount = 0;
            const now = Date.now();
            const expiryTime = CACHE_EXPIRY_DAYS * 24 * 60 * 60 * 1000;
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith(CACHE_PREFIX)) {
                    try {
                        const cacheData = JSON.parse(localStorage.getItem(key));
                        if (cacheData && cacheData.timestamp && (now - cacheData.timestamp) < expiryTime) {
                            cacheCount++;
                        }
                    } catch (e) {
                        // å¿½ç•¥è§£æé”™è¯¯çš„ç¼“å­˜
                    }
                }
            }
            
            cacheStats.textContent = cacheCount;
        }

        // æ›´æ–°å†å²è®°å½•ç»Ÿè®¡
        function updateHistoryStats() {
            const history = getHistory();
            historyStats.textContent = history.length;
        }

        // è·å–ç¼“å­˜é”®å
        function getCacheKey(dateStr) {
            return `${CACHE_PREFIX}${dateStr}`;
        }

        // ä»ç¼“å­˜è·å–æ•°æ®
        function getFromCache(dateStr) {
            if (!useCache) return null;
            
            const cacheKey = getCacheKey(dateStr);
            const cached = localStorage.getItem(cacheKey);
            
            if (!cached) return null;
            
            try {
                const cacheData = JSON.parse(cached);
                const now = Date.now();
                const expiryTime = CACHE_EXPIRY_DAYS * 24 * 60 * 60 * 1000;
                
                // æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸ
                if (cacheData.timestamp && (now - cacheData.timestamp) < expiryTime) {
                    return cacheData.data;
                } else {
                    // ç¼“å­˜è¿‡æœŸï¼Œåˆ é™¤
                    localStorage.removeItem(cacheKey);
                    return null;
                }
            } catch (e) {
                console.error('è§£æç¼“å­˜æ•°æ®æ—¶å‡ºé”™:', e);
                return null;
            }
        }

        // ä¿å­˜æ•°æ®åˆ°ç¼“å­˜
        function saveToCache(dateStr, data) {
            if (!useCache) return;
            
            const cacheKey = getCacheKey(dateStr);
            const cacheData = {
                data: data,
                timestamp: Date.now()
            };
            
            try {
                localStorage.setItem(cacheKey, JSON.stringify(cacheData));
                updateCacheStats();
            } catch (e) {
                console.error('ä¿å­˜ç¼“å­˜æ—¶å‡ºé”™:', e);
            }
        }

        // æ¸…é™¤æ‰€æœ‰ç¼“å­˜
        function clearAllCache() {
            const keysToRemove = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith(CACHE_PREFIX) || key === USER_PREFERENCE_KEY) {
                    keysToRemove.push(key);
                }
            }
            
            keysToRemove.forEach(key => {
                localStorage.removeItem(key);
            });
            
            userPreferenceVector = {};
            updateCacheStats();
            alert(`å·²æ¸…é™¤ ${keysToRemove.length} ä¸ªç¼“å­˜æ¡ç›®å’Œç”¨æˆ·åå¥½æ•°æ®`);
        }

        // å†å²è®°å½•ç›¸å…³å‡½æ•°
        function getHistory() {
            try {
                const historyJson = localStorage.getItem(HISTORY_KEY);
                return historyJson ? JSON.parse(historyJson) : [];
            } catch (e) {
                console.error('è¯»å–å†å²è®°å½•æ—¶å‡ºé”™:', e);
                return [];
            }
        }

        function saveHistory(history) {
            try {
                // é™åˆ¶å†å²è®°å½•æ•°é‡
                if (history.length > MAX_HISTORY_ITEMS) {
                    history = history.slice(history.length - MAX_HISTORY_ITEMS);
                }
                
                localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
                updateHistoryStats();
            } catch (e) {
                console.error('ä¿å­˜å†å²è®°å½•æ—¶å‡ºé”™:', e);
            }
        }

        function addHistoryItem(type, data) {
            const history = getHistory();
            const now = new Date();
            
            const historyItem = {
                type: type,
                data: data,
                timestamp: now.getTime(),
                displayTime: now.toLocaleString('zh-CN')
            };
            
            history.push(historyItem);
            saveHistory(history);
            updateHistoryStats();
        }

        function clearHistory() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å†å²è®°å½•å—ï¼ŸåŒæ—¶ä¼šæ¸…é™¤ç”¨æˆ·æ¨èåå¥½ã€‚')) {
                localStorage.removeItem(HISTORY_KEY);
                localStorage.removeItem(USER_PREFERENCE_KEY);
                userPreferenceVector = {};
                updateHistoryStats();
                renderTimeline();
                alert('å†å²è®°å½•å’Œç”¨æˆ·åå¥½å·²æ¸…é™¤');
            }
        }

        // æ¸²æŸ“æ—¶é—´çº¿
        function renderTimeline() {
            const history = getHistory();
            
            if (history.length === 0) {
                timelineContainer.innerHTML = `
                    <div class="timeline-empty">
                        <i class="fas fa-history"></i>
                        <div>æš‚æ— å†å²è®°å½•</div>
                        <p style="margin-top: 8px; font-size: 14px;">å¼€å§‹æµè§ˆæ ‘æ´æ¡£æ¡ˆï¼Œè¿™é‡Œä¼šè®°å½•æ‚¨çš„æ´»åŠ¨</p>
                    </div>
                `;
                return;
            }
            
            // æŒ‰æ—¶é—´å€’åºæ’åˆ—
            const sortedHistory = [...history].sort((a, b) => b.timestamp - a.timestamp);
            
            let html = '';
            
            sortedHistory.forEach((item, index) => {
                if (item.type === 'date_view') {
                    html += `
                        <div class="timeline-item" data-date="${item.data.date}" onclick="jumpToDate('${item.data.date}')">
                            <div class="timeline-date">
                                <i class="fas fa-calendar-day"></i>
                                ${item.data.date}
                            </div>
                            <div class="timeline-time">${item.displayTime}</div>
                            <div class="timeline-content">å†å²ä¸Šçš„è¿™ä¸€å¤©PKUerå‘äº† ${item.data.postCount} ä¸ªå¸–å­ï¼Œè´¡çŒ®äº† ${item.data.commentCount} æ¡è¯„è®º</div>
                        </div>
                    `;
                } else if (item.type === 'post_view') {
                    html += `
                        <div class="timeline-item timeline-post" data-date="${item.data.date}" data-post-id="${item.data.postId}" onclick="jumpToPost('${item.data.date}', ${item.data.postId})">
                            <div class="timeline-date">
                                <i class="fas fa-file-alt"></i>
                                å¸–å­ #${item.data.postId}
                            </div>
                            <div class="timeline-time">${item.displayTime}</div>
                            <div class="timeline-content">åœ¨ ${item.data.date} æŸ¥çœ‹äº†å¸–å­ "${item.data.preview}"</div>
                        </div>
                    `;
                }
            });
            
            timelineContainer.innerHTML = html;
        }

        // è·³è½¬åˆ°æ—¥æœŸ
        function jumpToDate(dateStr) {
            const formattedDate = `${dateStr.substring(0, 4)}-${dateStr.substring(4, 6)}-${dateStr.substring(6, 8)}`;
            dateInput.value = formattedDate;
            loadFileByDate(dateStr);
            closeModal(historyModal);
        }

        // è·³è½¬åˆ°å¸–å­
        function jumpToPost(dateStr, postId) {
            jumpToDate(dateStr);
            
            // ç­‰å¾…æ•°æ®åŠ è½½å®Œæˆåè·³è½¬åˆ°å¸–å­
            setTimeout(() => {
                const postElement = document.querySelector(`.hole-card[data-id="${postId}"]`);
                if (postElement) {
                    if (currentLayout === 'split' && !isMobile) {
                        showRightPanel(postId, true);
                        
                        // æ»šåŠ¨åˆ°å¸–å­ä½ç½®
                        const containerTop = postsContainer.getBoundingClientRect().top;
                        const cardTop = postElement.getBoundingClientRect().top;
                        const scrollAmount = cardTop - containerTop - 20;
                        
                        postsContainer.scrollBy({ top: scrollAmount, behavior: 'smooth' });
                    }
                }
            }, 500);
            
            closeModal(historyModal);
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modal) {
            modal.classList.remove('active');
        }

        // æ‰“å¼€æ¨¡æ€æ¡†
        function openModal(modal) {
            modal.classList.add('active');
            if (modal === historyModal) {
                renderTimeline();
            }
        }

        // çƒ­åº¦è®¡ç®—å‡½æ•°
        function calculateHotness(post) {
            // åŸºç¡€çƒ­åº¦ = è¯„è®ºæ•° Ã— 1.2 + å›´è§‚æ•° Ã— 1.5
            const commentCount = post.comments.length;
            const watchCount = Math.abs(post.watches) || 0;
            let hotness = commentCount * 1.2 + watchCount * 1.5;
            
            // å¯¹äºæ²¡æœ‰ä»»ä½•è¯„è®ºå’Œå›´è§‚çš„å¸–å­ï¼Œé»˜è®¤çƒ­åº¦ä¸º1.0
            if (commentCount === 0 && watchCount === 0) {
                hotness = 1.0;
            }
            
            return hotness.toFixed(1); // æ˜¾ç¤ºåˆ°å°æ•°ç‚¹å1ä½
        }

        // è§£ææ ‘æ´æ–‡ä»¶
        function parseHoleFile(content) {
            const lines = content.split('\n');
            const posts = [];
            let currentPost = null;
            let pendingComment = null; // ç”¨äºå¤šè¡Œè¯„è®º
            
            for (let line of lines) {
                line = line.trim();
                if (!line) continue;
                
                // è§£æå¸–å­è¡Œ
                const postMatch = line.match(/^#p\s+(\d+)\s+(\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}:\d{2})\s+(-?\d+)\s+(-?\d+)$/);
                if (postMatch) {
                    if (currentPost) {
                        posts.push(currentPost);
                    }
                    
                    const postId = parseInt(postMatch[1]);
                    const timestamp = postMatch[2];
                    const watches = parseInt(postMatch[3]);
                    
                    currentPost = {
                        id: postId,
                        time: timestamp,
                        watches: watches,
                        content: '',
                        comments: [],
                        isMissed: false,
                        isDeleted: false, // æ–°å¢ï¼šæ ‡è®°æ˜¯å¦æ˜¯è¢«åˆ é™¤çš„å¸–å­
                        hotness: 0, // åˆå§‹çƒ­åº¦
                        similarity: 0 // æ¨èç›¸ä¼¼åº¦
                    };
                    pendingComment = null; // é‡ç½®
                    continue;
                }
                
                // è§£æè¯„è®ºå¼€å§‹è¡Œ
                const commentStartMatch = line.match(/^#c\s+(\d+)\s+(\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}:\d{2})$/);
                if (commentStartMatch && currentPost) {
                    const commentId = commentStartMatch[1];
                    const timestamp = commentStartMatch[2];
                    pendingComment = {
                        id: commentId,
                        time: timestamp,
                        user: '',
                        content: ''
                    };
                    continue;
                }
                
                // è§£æè¯„è®ºå†…å®¹è¡Œ
                if (pendingComment && currentPost) {
                    const commentContentMatch = line.match(/^\[([^\]]+)\]\s*(.+)$/);
                    if (commentContentMatch) {
                        pendingComment.user = commentContentMatch[1];
                        pendingComment.content = commentContentMatch[2];
                        currentPost.comments.push(pendingComment);
                        pendingComment = null;
                        continue;
                    }
                }
                
                // MISSED æ¡ç›®
                if (line.startsWith('#MISSED') && currentPost) {
                    currentPost.content = '#MISSED';
                    currentPost.isMissed = true;
                    pendingComment = null;
                    continue;
                }
                
                // å¸–å­å†…å®¹ - æ£€æŸ¥æ˜¯å¦ä»¥#DELETEDå¼€å¤´
                if (currentPost && !currentPost.content.startsWith('#MISSED')) {
                    // æ£€æŸ¥æ˜¯å¦æ˜¯#DELETEDå¸–å­
                    if (line.startsWith('#DELETED')) {
                        currentPost.isDeleted = true;
                        // ç§»é™¤#DELETEDæ ‡è®°ï¼Œåªä¿ç•™åé¢çš„å†…å®¹
                        const remainingContent = line.substring('#DELETED'.length).trim();
                        if (remainingContent) {
                            currentPost.content = remainingContent;
                        }
                        continue;
                    }
                    
                    if (currentPost.content) {
                        currentPost.content += '\n' + line;
                    } else {
                        currentPost.content = line;
                    }
                }
            }
            
            // æ·»åŠ æœ€åä¸€ä¸ªå¸–å­
            if (currentPost) {
                posts.push(currentPost);
            }
            
            // è®¡ç®—æ¯ä¸ªå¸–å­çš„çƒ­åº¦
            posts.forEach(post => {
                if (!post.isMissed) {
                    post.hotness = calculateHotness(post);
                } else {
                    post.hotness = 0;
                }
            });
            
            // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
            const totalComments = posts.reduce((sum, post) => sum + post.comments.length, 0);
            
            // ç¡®å®šæ—¥æœŸ
            let date = null;
            if (posts.length > 0) {
                const firstPostTime = posts[0].time;
                date = firstPostTime.substring(0, 10);
            }
            
            // åº”ç”¨æ¨èç®—æ³•
            const sortedPosts = applyRecommendationAlgorithm(posts, currentSortMethod);
            
            return {
                date: date,
                posts: sortedPosts,
                stats: {
                    totalPosts: sortedPosts.length,
                    totalComments: totalComments,
                    dateRange: date
                }
            };
        }

        // è·å–çƒ­åº¦é¢œè‰²ç±»
        function getHotnessColorClass(hotness, hotnessPercentile) {
            if (hotness === 1.0) {
                return 'green'; // çƒ­åº¦1.0ä¸ºç»¿è‰²
            }
            
            if (hotnessPercentile <= 0.01) {
                return 'purple'; // å‰1%
            } else if (hotnessPercentile <= 0.05) {
                return 'red'; // 1%-5%
            } else if (hotnessPercentile <= 0.20) {
                return 'orange'; // 5%-20%
            } else {
                return 'gray'; // 20%-99%
            }
        }

        // è®¡ç®—çƒ­åº¦ç™¾åˆ†ä½
        function calculateHotnessPercentiles(posts) {
            // è¿‡æ»¤æ‰ç¼ºå¤±å’Œè¢«åˆ é™¤çš„å¸–å­ï¼Œåªè®¡ç®—æœ‰çƒ­åº¦çš„å¸–å­
            const validPosts = posts.filter(post => !post.isMissed && !post.isDeleted && post.hotness > 0);
            
            if (validPosts.length === 0) return {};
            
            // æŒ‰çƒ­åº¦æ’åº
            const sortedByHotness = [...validPosts].sort((a, b) => parseFloat(b.hotness) - parseFloat(a.hotness));
            
            // è®¡ç®—æ¯ä¸ªå¸–å­çš„ç™¾åˆ†ä½
            const percentiles = {};
            sortedByHotness.forEach((post, index) => {
                percentiles[post.id] = (index + 1) / sortedByHotness.length;
            });
            
            return percentiles;
        }

        // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤ºï¼ˆåŸºäºæ–‡æ¡£æ—¥æœŸï¼Œä»…åœ¨åŒä¸€å¤©æ—¶æ˜¾ç¤ºæ—¶é—´ï¼‰
        function formatTimeDisplay(timestamp, docDate) {
            const dateStr = timestamp.substring(0, 10);
            
            // åªåœ¨åŒä¸€å¤©æ—¶æ˜¾ç¤ºæ—¶é—´
            if (dateStr === docDate) {
                return timestamp.substring(11, 16); // HH:mm
            }
            return '';
        }

        // æ ¼å¼åŒ–è¯¦ç»†æ—¥æœŸæ˜¾ç¤ºï¼ˆç”¨äºå¸–å­å’Œè¯„è®ºä¸­çš„æ—¥æœŸï¼‰
        function formatDetailedDateTime(timestamp, docDate) {
            const time = timestamp.substring(11, 16); // HH:mm
            const dateStr = timestamp.substring(0, 10); // YYYY-MM-DD
            
            // å¦‚æœæ˜¯åŒä¸€å¤©ï¼Œä¸æ˜¾ç¤ºæ—¥æœŸ
            if (dateStr === docDate) {
                return '';
            }
            
            // è®¡ç®—æ˜¯å¦ä¸ºç¬¬äºŒå¤©
            const postDate = new Date(dateStr + 'T00:00:00');
            const docDateObj = new Date(docDate + 'T00:00:00');
            const diffTime = postDate - docDateObj;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            // å¦‚æœæ˜¯ç¬¬äºŒå¤©ï¼Œæ˜¾ç¤º"ç¬¬äºŒå¤© HH:mm"
            if (diffDays === 1) {
                return `ç¬¬äºŒå¤© ${time}`;
            }
            
            // å…¶ä»–æ—¥æœŸï¼Œæ˜¾ç¤ºå®Œæ•´æ—¥æœŸå’Œæ—¶é—´
            return `${dateStr} ${time}`;
        }

        // è¡¨æƒ…æ˜ å°„è¡¨
        const emojiMap = {
            'ä¸': 'âŒ',
            'åŠ³èµ„': 'ğŸ˜ ',
            'å›§-çª˜è¿«': 'ğŸ˜©',
            'ä¼¤ä¸èµ·': 'ğŸ˜¢',
            'äº²äº²': 'ğŸ˜˜',
            'ä¼¤å¿ƒ': 'ğŸ˜¢',
            'å‚²å¨‡': 'ğŸ˜',
            'å†·æ±—': 'ğŸ˜°',
            'åŠ æ²¹': 'ğŸ’ª',
            'å‘å‘†': 'ğŸ˜',
            'å¯æ€œ': 'ğŸ¥º',
            'å¯çˆ±': 'ğŸ¥°',
            'åŒæ„': 'ğŸ‘',
            'å': 'ğŸ¤®',
            'åè¡€': 'ğŸ˜µ',
            'å»': 'ğŸ’‹',
            'å‘•å': 'ğŸ¤¢',
            'å‘²ç‰™': 'ğŸ˜',
            'å‘µå‘µ': 'ğŸ˜Œ',
            'å’’éª‚': 'ğŸ˜¤',
            'å“ˆå“ˆ': 'ğŸ˜„',
            'å“¦': 'ğŸ˜²',
            'å“­': 'ğŸ˜­',
            'å“­å“­': 'ğŸ˜­',
            'å“­å”§å”§': 'ğŸ˜­',
            'å“­æ³£': 'ğŸ˜­',
            'å”‰': 'ğŸ˜”',
            'å•Šå•Šå•Š': 'ğŸ˜±',
            'å–µ': 'ğŸ˜¸',
            'å–·è¡€': 'ğŸ˜µ',
            'å˜´å”‡': 'ğŸ˜˜',
            'å˜»å˜»': 'ğŸ˜„',
            'å˜¿å“ˆ': 'ğŸ˜„',
            'å™˜å˜´': 'ğŸ˜’',
            'å›å¤´': 'ğŸ”„',
            'å›§': 'ğŸ˜©',
            'å›°': 'ğŸ˜´',
            'åç¬‘': 'ğŸ˜',
            'å¤§å“­': 'ğŸ˜­',
            'å¤§æ‹‡æŒ‡': 'ğŸ‘',
            'å¤§ç¬‘': 'ğŸ˜†',
            'å¤ªå¼€å¿ƒ': 'ğŸ˜„',
            'å¤ªéš¾äº†': 'ğŸ˜©',
            'å¤ªé«˜å…´': 'ğŸ˜„',
            'å¤±æœ›': 'ğŸ˜',
            'å¤´ç§ƒ': 'ğŸ³',
            'å¥‹æ–—': 'ğŸ’ª',
            'å¥–åŠ±': 'ğŸ',
            'å¥¸ç¬‘': 'ğŸ˜',
            'å¥½å›§': 'ğŸ˜©',
            'å¥½çš„': 'ğŸ‘',
            'å¦‡å¥³': 'ğŸ‘©',
            'å§”å±ˆ': 'ğŸ˜”',
            'å§”å±ˆè„¸': 'ğŸ˜­',
            'å«Œå¼ƒ': 'ğŸ˜’',
            'å®³ç¾': 'ğŸ˜³',
            'å°´å°¬': 'ğŸ˜³',
            'å°´å°¬è„¸': 'ğŸ˜³',
            'å·¦å“¼å“¼': 'ğŸ˜’',
            'å¼€å¿ƒ': 'ğŸ˜„',
            'å¼±': 'ğŸ˜',
            'å¼º': 'ğŸ’ª',
            'å¾å‹': 'â¤ï¸',
            'å¾—æ„': 'ğŸ˜',
            'å¾®ç¬‘': 'ğŸ™‚',
            'å¾®ç¬‘è„¸': 'ğŸ™‚',
            'å¿ƒ': 'â¤ï¸',
            'å¿ƒç¢': 'ğŸ’”',
            'å¿§ä¼¤': 'ğŸ˜',
            'å¿«å“­äº†': 'ğŸ˜­',
            'æ€„ç«': 'ğŸ˜¤',
            'æ€è€ƒ': 'ğŸ¤”',
            'æ³æ±‚': 'ğŸ™',
            'æ‚ é—²': 'ğŸ˜',
            'æ‚²ä¼¤': 'ğŸ˜',
            'æƒŠå“': 'ğŸ˜²',
            'æƒŠæ': 'ğŸ˜¨',
            'æƒŠè®¶': 'ğŸ˜®',
            'æ„‰å¿«': 'ğŸ˜Š',
            'æ„‰æ‚¦': 'ğŸ˜Š',
            'æ„ŸåŠ¨': 'ğŸ˜­',
            'æ†¨ç¬‘': 'ğŸ˜„',
            'æ‡µé€¼è„¸': 'ğŸ˜•',
            'æ‰‹æ®‹': 'ğŸ™ˆ',
            'æ‰“è„¸': 'ğŸ‘‹',
            'æ‰“è±†è±†': 'ğŸ‘Š',
            'æ‰”è‚¥çš‚': 'ğŸ§¼',
            'æ‰˜è…®': 'ğŸ¤”',
            'æ‰£é¼»': 'ğŸ™‰',
            'æ‰¶é¢': 'ğŸ˜”',
            'æŠ“ç‹‚': 'ğŸ˜«',
            'æŠ›åªšçœ¼': 'ğŸ˜‰',
            'æŠ é¼»': 'ğŸ™‰',
            'æŠ±æ‹³': 'ğŸ™',
            'æ‹œæ‹œ': 'ğŸ‘‹',
            'æ‹¥æŠ±': 'ğŸ¤—',
            'æ‹³å¤´': 'ğŸ‘Š',
            'æŒ–é¼»å±': 'ğŸ™‰',
            'æŒ å¤´': 'ğŸ¤”',
            'æ‚çœ¼': 'ğŸ™ˆ',
            'æ‚è„¸': 'ğŸ¤¦',
            'æ‚è„¸è·‘': 'ğŸƒ',
            'æ‚è„¸é€ƒ': 'ğŸƒ',
            'æ¡æ‰‹': 'ğŸ¤',
            'æ‘Šæ‰‹': 'ğŸ¤·',
            'æ‘”': 'ğŸ“‰',
            'æ‘¸æ‘¸å¤´': 'ğŸ™',
            'æ’‡å˜´': 'ğŸ˜’',
            'æ–œçœ¼': 'ğŸ˜‰',
            'æ–œçœ¼ç¬‘': 'ğŸ˜',
            'æ— å¥ˆ': 'ğŸ˜’',
            'æ— å¥ˆè„¸': 'ğŸ˜’',
            'æ— èŠ': 'ğŸ˜',
            'æ˜Ÿæ˜Ÿçœ¼': 'â­',
            'æ™•': 'ğŸ˜µ',
            'æ¯”å¿ƒ': 'ğŸ’•',
            'æ¯”å¦‚æˆ‘': 'ğŸ™‹',
            'çˆ†å“­': 'ğŸ˜­',
            'çˆ±': 'ğŸ’•',
            'çˆ±ä½ ': 'ğŸ’•',
            'çˆ±å¿ƒ': 'â¤ï¸',
            'ç‹‚æ±—': 'ğŸ˜…',
            'ç‹—å¤´': 'ğŸ•',
            'ç«ç‘°': 'ğŸŒ¹',
            'ç«ç‘°èŠ±': 'ğŸŒ¹',
            'ç”Ÿæ°”': 'ğŸ˜ ',
            'ç”Ÿç—…': 'ğŸ¤’',
            'ç–‘é—®': 'â“',
            'ç–¯äº†': 'ğŸ¤ª',
            'ç™¼å‘†': 'ğŸ˜',
            'ç™½çœ¼': 'ğŸ™„',
            'çš±çœ‰': 'ğŸ˜ ',
            'çšºçœ‰': 'ğŸ˜ ',
            'ç›¯': 'ğŸ‘€',
            'çœ‹': 'ğŸ‘€',
            'ç¡': 'ğŸ˜´',
            'çŸ³åŒ–': 'ğŸ˜',
            'ç¬‘': 'ğŸ˜„',
            'ç¬‘å“­': 'ğŸ˜‚',
            'ç¬‘æŠ½': 'ğŸ˜‚',
            'ç¬‘æ­»': 'ğŸ˜‚',
            'ç¬‘è„¸': 'ğŸ˜Š',
            'ç³—å¤§äº†': 'ğŸ˜©',
            'çº¢åŒ…': 'ğŸ§§',
            'ç¾': 'ğŸ˜',
            'ç¾': 'ğŸ˜³',
            'ç¾æ¶©': 'ğŸ˜³',
            'è€¶': 'ğŸ‰',
            'èƒœåˆ©': 'âœŒï¸',
            'è„¸çº¢': 'ğŸ˜Š',
            'è†œæ‹œ': 'ğŸ™',
            'è‡´éƒç³»': 'ğŸ˜',
            'èˆ”': 'ğŸ˜‹',
            'è‰²è¿·è¿·': 'ğŸ˜',
            'èŠ±ç—´è„¸': 'ğŸ˜',
            'è‹¦è„¸': 'ğŸ˜',
            'èœåˆ€': 'ğŸ”ª',
            'è“å¤©': 'ğŸŒ¤ï¸',
            'èœ¡çƒ›': 'ğŸ•¯ï¸',
            'è ¢å“­': 'ğŸ˜­',
            'è¡°': 'ğŸ˜',
            'è®¤çœŸ': 'ğŸ˜ ',
            'è®¤é¢†': 'ğŸ·ï¸',
            'è¯šæ³': 'ğŸ™',
            'è°ƒçš®': 'ğŸ˜œ',
            'è°„ç¬‘': 'ğŸ˜',
            'èµ': 'ğŸ‘',
            'èµ°ä½ ': 'ğŸš¶',
            'è¶…å‡¶': 'ğŸ˜¤',
            'è¶…å°å£°': 'ğŸ¤',
            'è·ªäº†': 'ğŸ™‡',
            'è·³è·³': 'ğŸ¤¸',
            'è½¬åœˆ': 'ğŸ”„',
            'è½¬è®©': 'ğŸ·ï¸',
            'è¾£çœ¼ç›': 'ğŸ‘€',
            'è¿åº§': 'ğŸª‘',
            'è¿·æƒ‘': 'ğŸ˜•',
            'é€': 'ğŸ',
            'é…·': 'ğŸ˜',
            'é…¸': 'ğŸ˜’',
            'é—®': 'â“',
            'é—®å·è„¸': 'ğŸ˜•',
            'é˜²æµæ„Ÿ': 'ğŸ˜·',
            'é˜´é™©': 'ğŸ˜',
            'é™æ¸©': 'ğŸ§Š',
            'éš¾å—': 'ğŸ˜',
            'éš¾è¿‡': 'ğŸ˜­',
            'é èº¬': 'ğŸ™‡',
            'é£æ‰‡': 'ğŸŒªï¸',
            'é£ç­': 'ğŸª',
            'é¦‹å˜´': 'ğŸ˜‹',
            'é²œèŠ±': 'ğŸŒ¹',
            'é¸­æ¢¨': 'ğŸ',
            'é»„ç‰Œ': 'ğŸŸ¨',
            'é»‘è„¸': 'ğŸ˜¤',
            'é»˜å“€': 'ğŸ™',
            'é¼“æŒ': 'ğŸ‘',
            'é¾‡ç‰™': 'ğŸ˜'
        };

        // å¤„ç†æ–‡æœ¬å†…å®¹ï¼ˆè¡¨æƒ…ã€@ç­‰ï¼‰
        function processTextContent(text) {
            if (!text) return '';
            
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/\n/g, '<br>')
                .replace(/å›å¤([^:ï¼š]+)[:\uff1a]\s*/g, 'å›å¤<span class="mention">@$1</span> : ')
                .replace(/Re ([^:ï¼š]+)[:\uff1a]\s*/g, 'å›å¤<span class="mention">@$1</span> : ')
                .replace(/\[([^\]]+)\]/g, function(match, content) {
                    const emoji = emojiMap[content];
                    if (emoji) {
                        return `<span class="emoji" title="${content}">${emoji}</span>`;
                    }
                    // å¦‚æœæ²¡æœ‰æ˜ å°„ï¼Œä¿æŒåŸæ ·
                    return `<span class="emoji">[${content}]</span>`;
                })
                .replace(/@([^\s]+)/g, '<span class="mention">@$1</span>');
        }

        // æ ¹æ®æ—¥æœŸåŠ è½½æ–‡ä»¶
        async function loadFileByDate(dateStr) {
            if (!dateStr) return;
            
            // éšè—ç©ºçŠ¶æ€
            emptyState.style.display = 'none';
            splitLayout.style.display = 'flex';
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoading();
            
            try {
                let data = null;
                let fromCache = false;
                
                // å°è¯•ä»ç¼“å­˜è·å–
                const cachedData = getFromCache(dateStr);
                if (cachedData) {
                    data = cachedData;
                    fromCache = true;
                    console.log(`ä»ç¼“å­˜åŠ è½½æ•°æ®: ${dateStr}`);
                } else {
                    // ä»ç½‘ç»œåŠ è½½
                    let filePath;
                    if (isOnlineMode) {
                        // åœ¨çº¿æ¨¡å¼ï¼šGitHub raw content URL
                        const year = dateStr.substring(0, 4);
                        const month = dateStr.substring(4, 6);
                        filePath = `https://raw.githubusercontent.com/woct0rdho/pkuholebackup/master/archive/${year}${month}/pkuhole${dateStr}.txt`;
                    } else {
                        // æœ¬åœ°æ¨¡å¼ï¼šç›¸å¯¹è·¯å¾„
                        const year = dateStr.substring(0, 4);
                        const month = dateStr.substring(4, 6);
                        filePath = `archive/${year}${month}/pkuhole${dateStr}.txt`;
                    }
                    
                    const response = await fetch(filePath);
                    if (!response.ok) {
                        throw new Error(`æ— æ³•åŠ è½½æ–‡ä»¶: ${response.status}`);
                    }
                    
                    const content = await response.text();
                    data = parseHoleFile(content);
                    
                    // ä¿å­˜åˆ°ç¼“å­˜
                    saveToCache(dateStr, data);
                    console.log(`ä»ç½‘ç»œåŠ è½½å¹¶ç¼“å­˜æ•°æ®: ${dateStr}`);
                }
                
                currentData = data;
                
                // æ¸²æŸ“å†…å®¹
                renderHoleContent(currentData);
                
                // æ›´æ–°æ–‡ä»¶ä¿¡æ¯
                updateFileInfo(currentData, dateStr, fromCache);
                
                // æ›´æ–°æ—¥æœŸæ 
                updateDateBar(dateStr, data.stats.totalPosts, data.stats.totalComments);
                
                // ä¿å­˜å½“å‰æ—¥æœŸ
                currentDate = dateStr;
                
                // æ·»åŠ å†å²è®°å½•
                addHistoryItem('date_view', {
                    date: dateStr,
                    postCount: data.stats.totalPosts,
                    commentCount: data.stats.totalComments
                });
                
            } catch (error) {
                console.error('åŠ è½½æ–‡ä»¶æ—¶å‡ºé”™:', error);
                const modeText = isOnlineMode ? 'åœ¨çº¿' : 'æœ¬åœ°';
                postsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <div class="empty-title">åŠ è½½å¤±è´¥</div>
                        <div class="empty-text">
                            æ— æ³•åŠ è½½è¯¥æ—¥æœŸçš„æ ‘æ´æ¡£æ¡ˆï¼š${error.message}
                        </div>
                        <div class="empty-text" style="font-size: 12px; margin-top: 12px;">
                            æç¤ºï¼šå¦‚æœä½¿ç”¨æœ¬åœ°æ¨¡å¼ï¼Œè¯·ç¡®ä¿å·²ä¸‹è½½ç›¸åº”çš„æ•°æ®æ–‡ä»¶
                        </div>
                    </div>
                `;
            }
        }

        // è®¡ç®—å‰ä¸€å¤©æˆ–åä¸€å¤©
        function getAdjacentDate(offset) {
            if (!currentDate) return null;
            const year = parseInt(currentDate.substring(0, 4));
            const month = parseInt(currentDate.substring(4, 6)) - 1; // JS month 0-based
            const day = parseInt(currentDate.substring(6, 8));
            const date = new Date(year, month, day);
            date.setDate(date.getDate() + offset);
            const newYear = date.getFullYear();
            const newMonth = String(date.getMonth() + 1).padStart(2, '0');
            const newDay = String(date.getDate()).padStart(2, '0');
            return `${newYear}${newMonth}${newDay}`;
        }

        // æ¸²æŸ“æ ‘æ´å†…å®¹
        function renderHoleContent(data) {
            if (data.posts.length === 0) {
                postsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-inbox"></i>
                        </div>
                        <div class="empty-title">æ²¡æœ‰æ‰¾åˆ°æ ‘æ´å†…å®¹</div>
                        <div class="empty-text">
                            è¯¥æ–‡ä»¶ä¸åŒ…å«æœ‰æ•ˆçš„æ ‘æ´æ•°æ®ï¼Œè¯·é€‰æ‹©å…¶ä»–æ–‡ä»¶
                        </div>
                    </div>
                `;
                return;
            }
            
            // è®¡ç®—çƒ­åº¦ç™¾åˆ†ä½
            const hotnessPercentiles = calculateHotnessPercentiles(data.posts);
            
            let html = '';
            
            data.posts.forEach(post => {
                // æ ¹æ®å¼€å…³å†³å®šæ˜¯å¦æ˜¾ç¤º
                if ((post.isMissed && !showMissedPosts) || (post.isDeleted && !showDeletedPosts)) {
                    return; // è·³è¿‡ä¸æ˜¾ç¤ºçš„å¸–å­
                }
                
                // æ ¼å¼åŒ–æ—¶é—´
                const timeDisplay = formatTimeDisplay(post.time, data.date);
                const dateStr = post.time.substring(0, 10);
                const displayDateTime = formatDetailedDateTime(post.time, data.date);
                
                // å¤„ç†å¸–å­å†…å®¹
                const processedContent = processTextContent(post.content);
                
                // ç¡®å®šå¡ç‰‡ç±»å
                const cardClass = post.isMissed ? 'hole-card missed-post' : 
                                 post.isDeleted ? 'hole-card deleted-post' : 'hole-card';
                const hiddenClass = (post.isMissed && !showMissedPosts) || (post.isDeleted && !showDeletedPosts) ? 'hidden' : '';
                const clickableClass = (currentLayout === 'split' && !isMobile) ? 'clickable' : '';
                const activeClass = (activePostId === post.id && currentLayout === 'split' && !isMobile) ? 'active' : '';
                
                // è·å–çƒ­åº¦é¢œè‰²
                const hotnessPercentile = hotnessPercentiles[post.id] || 0;
                const hotnessColorClass = getHotnessColorClass(parseFloat(post.hotness), hotnessPercentile);
                
                html += `
                    <div class="${cardClass} ${hiddenClass} ${clickableClass} ${activeClass}" data-id="${post.id}" data-hotness="${post.hotness}">
                        <div class="card-header">
                            <div class="user-info">
                                <div class="post-time">
                                    <span class="post-id">#${post.id}</span>
                `;
                
                // æ·»åŠ åˆ é™¤æ ‡è®°
                if (post.isDeleted) {
                    html += `<span class="deleted-badge"><i class="fas fa-trash"></i> è¢«åˆ é™¤</span>`;
                }
                
                // æ˜¾ç¤ºå¸–å­å†…å®¹
                if (post.isMissed) {
                    html += `<span class="post-content-inline" style="color: var(--text-tertiary); font-style: italic;">è¯¥å¸–å­åœ¨æ•°æ®åº“ä¸­ç¼ºå¤±</span>`;
                } else {
                    // åœ¨å¡ç‰‡ä¸­åªæ˜¾ç¤ºç®€åŒ–çš„å†…å®¹ï¼ˆç¬¬ä¸€è¡Œæˆ–å‰100å­—ç¬¦ï¼‰
                    const previewContent = post.content.split('\n')[0].substring(0, 100);
                    const processedPreview = processTextContent(previewContent + (post.content.length > 100 ? '...' : ''));
                    html += `<span class="post-content-inline">${processedPreview}</span>`;
                }
                
                // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯å’Œçƒ­åº¦æ ‡ç­¾
                if (!post.isMissed) {
                    const votesDisplay = [];
                    if (post.watches !== 0) votesDisplay.push(`â­ ${post.watches}`);
                    if (post.comments.length !== 0) votesDisplay.push(`ğŸ’¬ ${post.comments.length}`);
                    
                    // çƒ­åº¦æ ‡ç­¾
                    if (post.hotness > 0) {
                        html += `<span class="hotness-tag ${hotnessColorClass}"><i class="fas fa-fire"></i> ${post.hotness}</span>`;
                    }
                    
                    // æ¨èæ ‡ç­¾ï¼ˆç›¸ä¼¼åº¦é«˜çš„å¸–å­ï¼‰
                    if (post.similarity > 0.3) {
                        html += `<span class="recommend-tag"><i class="fas fa-star"></i> æ¨è</span>`;
                    }
                    
                    if (votesDisplay.length > 0) {
                        html += `<span class="post-votes">${votesDisplay.join(' ')}</span>`;
                    }
                }
                
                html += `
                                    <span class="post-time-info">${timeDisplay}${displayDateTime ? (timeDisplay ? ' Â· ' : '') + displayDateTime : ''}</span>
                                </div>
                            </div>
                        </div>
                `;
                
                // ä¼ ç»Ÿå¸ƒå±€ï¼šæ˜¾ç¤ºå®Œæ•´å†…å®¹å’Œè¯„è®º
                if (currentLayout === 'traditional' && !post.isMissed) {
                    html += `
                        <div class="card-content">${processedContent}</div>
                    `;
                    
                    if (post.comments.length > 0) {
                        html += `
                            <div class="comments-section">
                                <div class="comments-title">
                                    <span>è¯„è®º</span>
                                    <span class="comment-count">${post.comments.length}</span>
                                </div>
                                <div class="comment-list">
                        `;
                        
                        post.comments.forEach(comment => {
                            const commentTimeDisplay = formatTimeDisplay(comment.time, data.date);
                            const displayCommentDateTime = formatDetailedDateTime(comment.time, data.date);
                            const processedComment = processTextContent(comment.content);
                            
                            html += `
                                <div class="comment-item">
                                    <div class="comment-content">
                                        <div class="comment-header">
                                            <div class="comment-username">${comment.user}</div>
                                            <div class="comment-text">${processedComment}</div>
                                            <div class="comment-meta">
                                                <span class="comment-time">${commentTimeDisplay}${displayCommentDateTime ? (commentTimeDisplay ? ' Â· ' : '') + displayCommentDateTime : ''}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        
                        html += `
                                </div>
                            </div>
                        `;
                    }
                }
                
                html += `</div>`;
            });
            
            postsContainer.innerHTML = html + '<div class="posts-scroll-area" id="postsScrollArea"></div>';
            
            // æ›´æ–°å¸ƒå±€æ ·å¼
            updateLayoutStyle();
            
            // ç»‘å®šäº¤äº’äº‹ä»¶
            bindInteractionEvents();
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            postsContainer.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">æ­£åœ¨è§£ææ ‘æ´æ¡£æ¡ˆ...</div>
                </div>
            `;
        }

        // æ›´æ–°æ–‡ä»¶ä¿¡æ¯
        function updateFileInfo(data, dateStr, fromCache = false) {
            const year = dateStr.substring(0, 4);
            const month = dateStr.substring(4, 6);
            const day = dateStr.substring(6, 8);
            const displayDate = `${year}-${month}-${day}`;
            fileName.textContent = displayDate;
            postCount.textContent = `æ ‘æ´: ${data.stats.totalPosts}`;
            commentCount.textContent = `è¯„è®º: ${data.stats.totalComments}`;
            
            // æ˜¾ç¤ºç¼“å­˜æŒ‡ç¤ºå™¨
            if (fromCache) {
                cacheIndicator.innerHTML = '<span class="cache-indicator"><i class="fas fa-database"></i> ç¼“å­˜</span>';
            } else {
                cacheIndicator.innerHTML = '';
            }
            
            fileInfo.style.display = 'flex';
        }

        // æ›´æ–°å¸ƒå±€æ ·å¼
        function updateLayoutStyle() {
            if (currentLayout === 'traditional' || isMobile) {
                postsContainer.classList.add('full-width');
                if (rightPanel) {
                    rightPanel.classList.remove('empty');
                }
                activePostId = null;
            } else {
                postsContainer.classList.remove('full-width');
                if (rightPanel && !activePostId) {
                    rightPanel.classList.add('empty');
                }
            }
        }

        // æ˜¾ç¤ºå³ä¾§é¢æ¿ï¼ˆåˆ†å±å¸ƒå±€ï¼‰
        function showRightPanel(postId, scrollToTop = true) {
            if (!postId || isMobile) return;
            
            // æŸ¥æ‰¾å¸–å­
            const post = currentData.posts.find(p => p.id === postId);
            if (!post || post.isMissed) return;
            
            // æ›´æ–°ç”¨æˆ·åå¥½å‘é‡
            updateUserPreference(post.content);
            
            // æ›´æ–°æ¿€æ´»çŠ¶æ€
            activePostId = postId;
            document.querySelectorAll('.hole-card').forEach(card => {
                card.classList.remove('active');
            });
            const activeCard = document.querySelector(`.hole-card[data-id="${postId}"]`);
            if (activeCard) {
                activeCard.classList.add('active');
                
                // ç‚¹å‡»æ¨¡å¼ä¸‹ï¼Œæ»šåŠ¨åˆ°å¸–å­ä½ç½®
                if (scrollToTop && currentInteraction === 'click') {
                    // è®¡ç®—å¸–å­åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®ï¼Œä½¿å…¶æ¥è¿‘é¡¶éƒ¨ä½†ä¿ç•™ä¸€ç‚¹ä¸Šä¸‹æ–‡
                    const containerTop = postsContainer.getBoundingClientRect().top;
                    const cardTop = activeCard.getBoundingClientRect().top;
                    const scrollAmount = cardTop - containerTop - 20; // 20px çš„åç§»
                    
                    postsContainer.scrollBy({ top: scrollAmount, behavior: 'smooth' });
                }
            }
            
            // æ¸²æŸ“å³ä¾§é¢æ¿å†…å®¹
            let html = '';
            
            // å¸–å­è¯¦æƒ…
            const timeDisplay = formatTimeDisplay(post.time, currentData.date);
            const displayDateTime = formatDetailedDateTime(post.time, currentData.date);
            const processedContent = processTextContent(post.content);
            
            html += `
                <div class="post-detail-card">
                    <div class="post-detail-content">${processedContent}</div>
                    <div class="post-detail-meta">
                        <span class="post-detail-id">#${post.id}</span>
                        <span>${timeDisplay}${displayDateTime ? (timeDisplay ? ' Â· ' : '') + displayDateTime : ''}</span>
                        <span class="post-detail-hotness"><i class="fas fa-fire"></i> ${post.hotness}</span>
                    </div>
                </div>
            `;
            
            // è¯„è®ºéƒ¨åˆ†
            if (post.comments.length > 0) {
                html += `
                    <div style="padding: 20px;">
                        <div class="comments-title">
                            <span>è¯„è®º (${post.comments.length})</span>
                        </div>
                        <div class="comment-list">
                `;
                
                post.comments.forEach(comment => {
                    const commentTimeDisplay = formatTimeDisplay(comment.time, currentData.date);
                    const displayCommentDateTime = formatDetailedDateTime(comment.time, currentData.date);
                    const processedComment = processTextContent(comment.content);
                    
                    html += `
                        <div class="comment-item">
                            <div class="comment-content">
                                <div class="comment-header">
                                    <div class="comment-username">${comment.user}</div>
                                    <div class="comment-text">${processedComment}</div>
                                    <div class="comment-meta">
                                        <span class="comment-time">${commentTimeDisplay}${displayCommentDateTime ? (commentTimeDisplay ? ' Â· ' : '') + displayCommentDateTime : ''}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            } else {
                html += `<div style="text-align: center; padding: 40px; color: var(--text-tertiary);">æš‚æ— è¯„è®º</div>`;
            }
            
            rightPanelContent.innerHTML = html;
            rightPanel.classList.remove('empty');
            
            // æ»šåŠ¨å³ä¾§é¢æ¿åˆ°é¡¶éƒ¨
            if (scrollToTop) {
                rightPanelContent.scrollTop = 0;
            }
            
            // æ·»åŠ å†å²è®°å½•
            const previewContent = post.content.split('\n')[0].substring(0, 50);
            addHistoryItem('post_view', {
                date: currentDate,
                postId: post.id,
                preview: previewContent + (post.content.length > 50 ? '...' : '')
            });
        }

        // å…³é—­å³ä¾§é¢æ¿
        function closeRightPanel() {
            activePostId = null;
            if (rightPanel) {
                rightPanel.classList.add('empty');
            }
            document.querySelectorAll('.hole-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // æ˜¾ç¤ºç©ºçŠ¶æ€
            if (rightPanelContent) {
                rightPanelContent.innerHTML = `
                    <div class="empty-panel">
                        <div class="empty-panel-icon">
                            <i class="fas fa-mouse-pointer"></i>
                        </div>
                        <div class="empty-panel-title">é€‰æ‹©å·¦ä¾§çš„å¸–å­æŸ¥çœ‹è¯¦æƒ…</div>
                        <div class="empty-panel-text">ç‚¹å‡»æˆ–æ‚¬åœå·¦ä¾§çš„å¸–å­å¡ç‰‡ï¼Œè¿™é‡Œå°†æ˜¾ç¤ºå®Œæ•´çš„å¸–å­å†…å®¹å’Œæ‰€æœ‰è¯„è®º</div>
                    </div>
                `;
            }
        }

        // ç»‘å®šäº¤äº’äº‹ä»¶
        function bindInteractionEvents() {
            const cards = document.querySelectorAll('.hole-card.clickable:not(.missed-post)');
            
            cards.forEach(card => {
                // ç§»é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨
                card.removeEventListener('click', handleCardClick);
                card.removeEventListener('mouseenter', handleCardHover);
                card.removeEventListener('mouseleave', handleCardLeave);
                
                // æ ¹æ®äº¤äº’æ¨¡å¼ç»‘å®šäº‹ä»¶
                if (currentLayout === 'split' && !isMobile) {
                    if (currentInteraction === 'click') {
                        card.addEventListener('click', handleCardClick);
                    } else if (currentInteraction === 'hover') {
                        card.addEventListener('mouseenter', handleCardHover);
                        card.addEventListener('mouseleave', handleCardLeave);
                    }
                }
            });
        }

        function handleCardClick(e) {
            if (currentLayout !== 'split' || isMobile) return;
            const postId = parseInt(e.currentTarget.dataset.id);
            if (activePostId === postId) {
                closeRightPanel();
            } else {
                showRightPanel(postId, true);
            }
        }

        function handleCardHover(e) {
            if (currentLayout !== 'split' || currentInteraction !== 'hover' || isMobile) return;
            const postId = parseInt(e.currentTarget.dataset.id);
            if (activePostId !== postId) {
                showRightPanel(postId, false);
            }
        }

        function handleCardLeave(e) {
            if (currentLayout !== 'split' || currentInteraction !== 'hover' || isMobile) return;
            // å»¶è¿Ÿå…³é—­ï¼Œé¿å…å¿«é€Ÿåˆ‡æ¢æ—¶é—ªçƒ
            setTimeout(() => {
                if (!e.currentTarget.matches(':hover')) {
                    closeRightPanel();
                }
            }, 100);
        }

        // é‡æ–°æ’åºå¹¶æ¸²æŸ“å†…å®¹
        function reSortAndRender() {
            if (currentData.posts.length > 0) {
                // åº”ç”¨æ¨èç®—æ³•é‡æ–°æ’åº
                currentData.posts = applyRecommendationAlgorithm(currentData.posts, currentSortMethod);
                renderHoleContent(currentData);
                
                // é‡æ–°è®¾ç½®å·²åˆ é™¤å¸–å­çš„æ˜¾ç¤ºçŠ¶æ€
                updatePostVisibility();
            }
        }

        // æ›´æ–°å¸–å­å¯è§æ€§
        function updatePostVisibility() {
            const missedCards = document.querySelectorAll('.hole-card.missed-post');
            const deletedCards = document.querySelectorAll('.hole-card.deleted-post');
            
            missedCards.forEach(card => {
                if (!showMissedPosts) {
                    card.classList.add('hidden');
                } else {
                    card.classList.remove('hidden');
                }
            });
            
            deletedCards.forEach(card => {
                if (!showDeletedPosts) {
                    card.classList.add('hidden');
                } else {
                    card.classList.remove('hidden');
                }
            });
        }

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initEventListeners() {
            // åˆ‡æ¢æ˜¾ç¤ºæ•°æ®åº“ä¸­ç¼ºå¤±çš„å¸–å­
            toggleMissedBtn.addEventListener('click', () => {
                showMissedPosts = !showMissedPosts;
                toggleMissedBtn.classList.toggle('active');
                updatePostVisibility();
            });
            
            // åˆ‡æ¢æ˜¾ç¤ºè¢«åˆ é™¤çš„å¸–å­
            toggleDeletedBtn.addEventListener('click', () => {
                showDeletedPosts = !showDeletedPosts;
                toggleDeletedBtn.classList.toggle('active');
                updatePostVisibility();
            });
            
            // æ’åºé€‰æ‹©å™¨äº‹ä»¶ç›‘å¬
            sortSelect.addEventListener('change', () => {
                currentSortMethod = sortSelect.value;
                reSortAndRender();
            });
            
            // å¸ƒå±€é€‰æ‹©å™¨äº‹ä»¶ç›‘å¬
            layoutSelect.addEventListener('change', () => {
                currentLayout = layoutSelect.value;
                
                // æ˜¾ç¤º/éšè—åˆ†å±äº¤äº’é€‰é¡¹
                if (currentLayout === 'split' && !isMobile) {
                    splitInteractionGroup.style.display = 'flex';
                    splitLayout.style.display = 'flex';
                } else {
                    splitInteractionGroup.style.display = 'none';
                    splitLayout.style.display = 'flex';
                    closeRightPanel();
                }
                
                // é‡æ–°æ¸²æŸ“
                if (currentData.posts.length > 0) {
                    renderHoleContent(currentData);
                }
            });
            
            // äº¤äº’æ¨¡å¼é€‰æ‹©å™¨äº‹ä»¶ç›‘å¬
            interactionSelect.addEventListener('change', () => {
                currentInteraction = interactionSelect.value;
                
                // é‡æ–°ç»‘å®šäº¤äº’äº‹ä»¶
                if (currentData.posts.length > 0) {
                    bindInteractionEvents();
                }
            });
            
            // å…³é—­å³ä¾§é¢æ¿æŒ‰é’®
            closeRightPanelBtn.addEventListener('click', closeRightPanel);
            
            // å›åˆ°é¡¶éƒ¨æŒ‰é’®äº‹ä»¶
            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            
            // æ»šåŠ¨æ—¶æ˜¾ç¤º/éšè—å›åˆ°é¡¶éƒ¨æŒ‰é’®
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    backToTopBtn.classList.add('visible');
                } else {
                    backToTopBtn.classList.remove('visible');
                }
            });
            
            // ç©ºçŠ¶æ€åŒºåŸŸç‚¹å‡»äº‹ä»¶
            uploadArea.addEventListener('click', () => {
                // é«˜äº®ä¸Šä¼ åŒºåŸŸå’ŒæŒ‰é’®
                uploadArea.classList.add('highlight');
                loadBtn.classList.add('highlight');
                dateInput.style.borderColor = 'var(--primary-color)';
                
                // 2ç§’åç§»é™¤é«˜äº®
                setTimeout(() => {
                    uploadArea.classList.remove('highlight');
                    loadBtn.classList.remove('highlight');
                    dateInput.style.borderColor = 'var(--border-color)';
                }, 2000);
            });
            
            // å…³äºæŒ‰é’®äº‹ä»¶
            aboutBtn.addEventListener('click', () => {
                openModal(aboutModal);
            });
            
            closeAboutBtn.addEventListener('click', () => {
                closeModal(aboutModal);
            });
            
            // å†å²æŒ‰é’®äº‹ä»¶
            historyBtn.addEventListener('click', () => {
                openModal(historyModal);
            });
            
            closeHistoryBtn.addEventListener('click', () => {
                closeModal(historyModal);
            });
            
            // æ¸…é™¤å†å²æŒ‰é’®äº‹ä»¶
            clearHistoryBtn.addEventListener('click', clearHistory);
            
            // æ¸…é™¤ç¼“å­˜æŒ‰é’®äº‹ä»¶
            clearCacheBtn.addEventListener('click', clearAllCache);
            
            // æ—¥æœŸæ éšè—æŒ‰é’®äº‹ä»¶
            hideDateBarBtn.addEventListener('click', toggleDateBar);
            
            // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
            window.addEventListener('click', (e) => {
                if (e.target === aboutModal) {
                    closeModal(aboutModal);
                }
                if (e.target === historyModal) {
                    closeModal(historyModal);
                }
            });
            
            // æ¨¡å¼åˆ‡æ¢æŒ‰é’®
            modeToggle.addEventListener('click', async () => {
                isOnlineMode = !isOnlineMode;
                if (isOnlineMode) {
                    modeText.textContent = 'ğŸŒ åœ¨çº¿æ¨¡å¼';
                } else {
                    // åˆ‡æ¢åˆ°æœ¬åœ°æ¨¡å¼æ—¶ï¼Œé‡æ–°æ£€æµ‹ä¸€ä¸‹
                    const hasLocalFiles = await detectLocalFiles();
                    if (hasLocalFiles) {
                        modeText.textContent = 'âœ“ ğŸ“ æœ¬åœ°æ¨¡å¼';
                    } else {
                        modeText.textContent = 'âš  ğŸ“ æœ¬åœ°æ¨¡å¼';
                    }
                }
            });

            // åŠ è½½æŒ‰é’®
            loadBtn.addEventListener('click', () => {
                const dateStr = dateInput.value.replace(/-/g, '');
                if (!dateInput.value) {
                    alert('è¯·é€‰æ‹©æ—¥æœŸï¼ˆ2013-12-15 è‡³ 2019-11-24ï¼‰');
                    return;
                }
                if (dateStr) {
                    loadFileByDate(dateStr);
                }
            });

            // æ—¥æœŸè¾“å…¥å›è½¦
            dateInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const dateStr = dateInput.value.replace(/-/g, '');
                    if (dateStr) {
                        loadFileByDate(dateStr);
                    }
                }
            });

            // å¯¼èˆªæŒ‰é’®äº‹ä»¶
            prevDayBtn.addEventListener('click', () => {
                if (!currentDate) {
                    alert('è¯·å…ˆåŠ è½½ä¸€ä¸ªæ—¥æœŸçš„æ•°æ®');
                    return;
                }
                const prevDate = getAdjacentDate(-1);
                if (prevDate) {
                    dateInput.value = `${prevDate.substring(0, 4)}-${prevDate.substring(4, 6)}-${prevDate.substring(6, 8)}`;
                    loadFileByDate(prevDate);
                } else {
                    alert('å·²åˆ°è¾¾æœ€æ—©æ—¥æœŸï¼ˆ2013-12-15ï¼‰');
                }
            });
            
            nextDayBtn.addEventListener('click', () => {
                if (!currentDate) {
                    alert('è¯·å…ˆåŠ è½½ä¸€ä¸ªæ—¥æœŸçš„æ•°æ®');
                    return;
                }
                const nextDate = getAdjacentDate(1);
                if (nextDate) {
                    dateInput.value = `${nextDate.substring(0, 4)}-${nextDate.substring(4, 6)}-${nextDate.substring(6, 8)}`;
                    loadFileByDate(nextDate);
                } else {
                    alert('å·²åˆ°è¾¾æœ€æ™šæ—¥æœŸï¼ˆ2019-11-24ï¼‰');
                }
            });
        }

        // æ£€æµ‹æœ¬åœ°æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        async function detectLocalFiles() {
            try {
                // å°è¯•åŠ è½½ç¬¬ä¸€ä¸ªæ–‡ä»¶æ¥æ£€æµ‹æœ¬åœ°æ–‡ä»¶æ˜¯å¦å­˜åœ¨
                const response = await fetch('archive/201312/pkuhole20131215.txt', { method: 'HEAD' });
                return response.ok;
            } catch (error) {
                // å¦‚æœå‡ºé”™ï¼Œå°è¯•ç”¨ GET è¯·æ±‚
                try {
                    const response = await fetch('archive/201312/pkuhole20131215.txt');
                    return response.ok;
                } catch (e) {
                    return false;
                }
            }
        }

        // åˆå§‹åŒ–ï¼šæ£€æµ‹æœ¬åœ°æ–‡ä»¶å¹¶è‡ªåŠ¨è®¾ç½®æ¨¡å¼
        document.addEventListener('DOMContentLoaded', async () => {
            // æ£€æµ‹è®¾å¤‡ç±»å‹
            detectDevice();
            
            // ç›‘å¬çª—å£å¤§å°å˜åŒ–
            window.addEventListener('resize', detectDevice);
            
            // è®¾ç½®æ—¥æœŸèŒƒå›´ï¼š2013-12-15 åˆ° 2019-11-24
            dateInput.min = '2013-12-15';
            dateInput.max = '2019-11-24';
            
            // è®¾ç½®é»˜è®¤å€¼ä¸ºæœ€åä¸€å¤©
            dateInput.value = '2019-11-24';
            
            // æ£€æµ‹æœ¬åœ°æ–‡ä»¶
            const hasLocalFiles = await detectLocalFiles();
            
            if (hasLocalFiles) {
                // æœ‰æœ¬åœ°æ–‡ä»¶ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡å¼
                isOnlineMode = false;
                modeText.textContent = 'âœ“ ğŸ“ æœ¬åœ°æ¨¡å¼';
            } else {
                // æ²¡æœ‰æœ¬åœ°æ–‡ä»¶ï¼Œä½¿ç”¨åœ¨çº¿æ¨¡å¼
                isOnlineMode = true;
                modeText.textContent = 'ğŸŒ åœ¨çº¿æ¨¡å¼';
            }
            
            // è®¾ç½®é»˜è®¤æ’åºæ–¹å¼
            sortSelect.value = currentSortMethod;
            layoutSelect.value = currentLayout;
            interactionSelect.value = currentInteraction;
            
            // ç§»åŠ¨ç«¯è°ƒæ•´
            if (isMobile) {
                splitInteractionGroup.style.display = 'none';
                currentLayout = 'traditional';
                layoutSelect.value = 'traditional';
                
                // éšè—åˆ†å±é€‰é¡¹
                const splitOption = document.querySelector('#layoutSelect option[value="split"]');
                if (splitOption) splitOption.style.display = 'none';
            }
            
            // åˆå§‹åŒ–å¼€å…³çŠ¶æ€
            toggleMissedBtn.classList.toggle('active', showMissedPosts);
            toggleDeletedBtn.classList.toggle('active', showDeletedPosts);
            
            // åˆå§‹åŒ–ç¼“å­˜å’Œç»Ÿè®¡
            initCacheAndStats();
            
            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
            initEventListeners();
            
            // æ·»åŠ é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', (e) => {
                // å¿½ç•¥åœ¨è¾“å…¥æ¡†ä¸­çš„æŒ‰é”®
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    return;
                }
                
                // å¿«æ·é”®å¤„ç†
                switch(e.key.toLowerCase()) {
                    case 'l':
                        // åˆ‡æ¢å¸ƒå±€ï¼ˆæ¡Œé¢ç«¯ï¼‰
                        if (!isMobile) {
                            e.preventDefault();
                            layoutSelect.value = layoutSelect.value === 'traditional' ? 'split' : 'traditional';
                            layoutSelect.dispatchEvent(new Event('change'));
                        }
                        break;
                    case ' ':
                        // ç©ºæ ¼é”®ï¼šå±•å¼€/å…³é—­è¯„è®º
                        e.preventDefault();
                        if (currentLayout === 'split' && activePostId && !isMobile) {
                            closeRightPanel();
                        }
                        break;
                    case 'arrowup':
                    case 'k':
                        // ä¸Šä¸€ä¸ªå¸–å­
                        e.preventDefault();
                        navigatePosts(-1);
                        break;
                    case 'arrowdown':
                    case 'j':
                        // ä¸‹ä¸€ä¸ªå¸–å­
                        e.preventDefault();
                        navigatePosts(1);
                        break;
                    case 'home':
                        // å›åˆ°é¡¶éƒ¨
                        e.preventDefault();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        break;
                    case 'end':
                        // åˆ°åº•éƒ¨
                        e.preventDefault();
                        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                        break;
                }
            });
        });
        
        // å¯¼èˆªå¸–å­ï¼ˆå¿«æ·é”®ç”¨ï¼‰
        function navigatePosts(direction) {
            if (currentData.posts.length === 0) return;
            
            const cards = Array.from(document.querySelectorAll('.hole-card.clickable:not(.hidden)'));
            if (cards.length === 0) return;
            
            let currentIndex = -1;
            if (activePostId) {
                currentIndex = cards.findIndex(card => parseInt(card.dataset.id) === activePostId);
            }
            
            let newIndex = currentIndex + direction;
            if (newIndex < 0) newIndex = 0;
            if (newIndex >= cards.length) newIndex = cards.length - 1;
            
            if (newIndex >= 0 && newIndex < cards.length) {
                const postId = parseInt(cards[newIndex].dataset.id);
                if (currentLayout === 'split' && !isMobile) {
                    showRightPanel(postId, true);
                }
            }
        }
        
    </script>
</body>
</html>
